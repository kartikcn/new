{"ast":null,"code":"import { UtilConstant } from 'src/common/UtilConstant';\nimport { SpaceUtilizationStatisticsFilterInputDTO } from './model/SpaceUtilizationStatisticsFilterInputDTO.model';\nimport * as FileSaver from 'file-saver';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../employee/services/employee.service\";\nimport * as i2 from \"../background-loc/services/bl.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"ng-zorro-antd/table\";\nimport * as i6 from \"primeng/api\";\nimport * as i7 from \"primeng/table\";\nimport * as i8 from \"primeng/button\";\nimport * as i9 from \"primeng/dialog\";\nimport * as i10 from \"primeng/checkbox\";\nimport * as i11 from \"@angular/material/tooltip\";\nimport * as i12 from \"./widgets/add-room-statistics-report-table/add-room-statistics-report-table.component\";\nfunction ViewOccupancyStatisticsComponent_div_23_ng_template_2_th_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const col_r8 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", col_r8.header, \" \");\n  }\n}\nfunction ViewOccupancyStatisticsComponent_div_23_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵtemplate(1, ViewOccupancyStatisticsComponent_div_23_ng_template_2_th_1_Template, 2, 1, \"th\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const columns_r6 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", columns_r6);\n  }\n}\nfunction ViewOccupancyStatisticsComponent_div_23_ng_template_3_td_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 22)(1, \"div\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const col_r12 = ctx.$implicit;\n    const rowData_r9 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", rowData_r9[col_r12.field], \" \");\n  }\n}\nfunction ViewOccupancyStatisticsComponent_div_23_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\", 23);\n    i0.ɵɵlistener(\"click\", function ViewOccupancyStatisticsComponent_div_23_ng_template_3_Template_tr_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const rowData_r9 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r14.onClickCount(rowData_r9));\n    });\n    i0.ɵɵtemplate(1, ViewOccupancyStatisticsComponent_div_23_ng_template_3_td_1_Template, 3, 1, \"td\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const columns_r10 = ctx.columns;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", columns_r10);\n  }\n}\nfunction ViewOccupancyStatisticsComponent_div_23_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2, \" No records found \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const columns_r16 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵattribute(\"colspan\", columns_r16.length + 1);\n  }\n}\nfunction ViewOccupancyStatisticsComponent_div_23_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\", 24);\n    i0.ɵɵtext(1, \"Room List\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ViewOccupancyStatisticsComponent_div_23_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-add-room-statistics-report-table\", 25);\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"data\", ctx_r5.roomData);\n  }\n}\nconst _c0 = function () {\n  return [5, 10, 25];\n};\nconst _c1 = function () {\n  return {\n    width: \"66vw\"\n  };\n};\nfunction ViewOccupancyStatisticsComponent_div_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"p-table\", 16);\n    i0.ɵɵtemplate(2, ViewOccupancyStatisticsComponent_div_23_ng_template_2_Template, 2, 1, \"ng-template\", 17);\n    i0.ɵɵtemplate(3, ViewOccupancyStatisticsComponent_div_23_ng_template_3_Template, 2, 1, \"ng-template\", 18);\n    i0.ɵɵtemplate(4, ViewOccupancyStatisticsComponent_div_23_ng_template_4_Template, 3, 1, \"ng-template\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p-dialog\", 20);\n    i0.ɵɵlistener(\"visibleChange\", function ViewOccupancyStatisticsComponent_div_23_Template_p_dialog_visibleChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.showPopUpGrid = $event);\n    });\n    i0.ɵɵtemplate(6, ViewOccupancyStatisticsComponent_div_23_ng_template_6_Template, 2, 0, \"ng-template\", 17);\n    i0.ɵɵtemplate(7, ViewOccupancyStatisticsComponent_div_23_ng_template_7_Template, 1, 1, \"ng-template\", 18);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"columns\", ctx_r0.columnData)(\"paginator\", true)(\"rows\", ctx_r0.rowCount)(\"scrollable\", true)(\"showCurrentPageReport\", true)(\"rowsPerPageOptions\", i0.ɵɵpureFunction0(16, _c0))(\"value\", ctx_r0.resultData)(\"loading\", ctx_r0.isTableRecordLoading)(\"rowHover\", false);\n    i0.ɵɵadvance(4);\n    i0.ɵɵstyleMap(i0.ɵɵpureFunction0(17, _c1));\n    i0.ɵɵproperty(\"visible\", ctx_r0.showPopUpGrid)(\"modal\", true)(\"maximizable\", true)(\"draggable\", false)(\"resizable\", false);\n  }\n}\nexport let ViewOccupancyStatisticsComponent = /*#__PURE__*/(() => {\n  class ViewOccupancyStatisticsComponent {\n    constructor(emService, blService) {\n      this.emService = emService;\n      this.blService = blService;\n      this.selectedOptions = [];\n      this.showTable = false;\n      this.rowCount = UtilConstant.ROW_COUNT;\n      this.isTableRecordLoading = false;\n      this.resultData = [];\n      this.columnData = [];\n      this.filterData = new SpaceUtilizationStatisticsFilterInputDTO(false, false, false, false);\n      this.grid_array = [];\n      this.showPopUpGrid = false;\n      this.roomData = [];\n    }\n    ngOnInit() {\n      this.onloadData();\n    }\n    checkboxSelected(event) {\n      this.isTableRecordLoading = true;\n      this.resultData = [];\n      this.columnData = [];\n      this.filterData = new SpaceUtilizationStatisticsFilterInputDTO(false, false, false, false);\n      this.selectedOptions.forEach(option => {\n        if (option == 'building') {\n          this.filterData.building = true;\n        }\n        if (option == 'floor') {\n          this.filterData.building = true;\n          this.filterData.floor = true;\n          if (!this.selectedOptions.includes('building')) {\n            this.selectedOptions.push('building');\n          }\n        }\n        if (option == 'division') {\n          this.filterData.division = true;\n        }\n        if (option == 'department') {\n          this.filterData.division = true;\n          this.filterData.department = true;\n          if (!this.selectedOptions.includes('division')) {\n            this.selectedOptions.push('division');\n          }\n        }\n      });\n      if (!this.filterData.division && !this.filterData.department && !this.filterData.building && !this.filterData.floor) {\n        this.resultData = [];\n        this.isTableRecordLoading = false;\n        this.showTable = true;\n      } else {\n        this.emService.getspaceutilization(this.filterData).subscribe(res => {\n          this.resultData = res;\n          this.generateColumnData();\n          this.showTable = true;\n          this.isTableRecordLoading = false;\n        });\n      }\n    }\n    onloadData() {\n      this.isTableRecordLoading = true;\n      this.selectedOptions.push('division');\n      this.filterData = new SpaceUtilizationStatisticsFilterInputDTO(false, false, false, false);\n      this.filterData.division = true;\n      this.emService.getspaceutilization(this.filterData).subscribe(res => {\n        this.resultData = res;\n        this.generateColumnData();\n        this.showTable = true;\n        this.isTableRecordLoading = false;\n      });\n    }\n    generateColumnData() {\n      if (this.filterData.division) {\n        this.columnData.push({\n          field: 'division',\n          header: 'Division'\n        });\n      }\n      if (this.filterData.department) {\n        this.columnData.push({\n          field: 'department',\n          header: 'Department'\n        });\n      }\n      if (this.filterData.building) {\n        this.columnData.push({\n          field: 'building',\n          header: 'Building'\n        });\n      }\n      if (this.filterData.floor) {\n        this.columnData.push({\n          field: 'floor',\n          header: 'Floor'\n        });\n      }\n      this.columnData.push({\n        field: 'totalSpace',\n        header: 'Total Seats'\n      });\n      this.columnData.push({\n        field: 'occupiedSpace',\n        header: 'Occupied Seats'\n      });\n      this.columnData.push({\n        field: 'availableSpace',\n        header: 'Available Seats'\n      });\n      this.columnData.push({\n        field: 'occupiedPercentage',\n        header: 'Occupancy (%)'\n      });\n    }\n    onClear() {\n      this.selectedOptions = [];\n      this.showTable = false;\n      this.isTableRecordLoading = false;\n      this.resultData = [];\n      this.columnData = [];\n      this.onloadData();\n      this.showPopUpGrid = false;\n    }\n    exportExcel() {\n      this.getDestructuredData(this.resultData);\n      var excelHeaders = [];\n      import(\"xlsx\").then(xlsx => {\n        const worksheet = xlsx.utils.json_to_sheet(this.grid_array);\n        worksheet['!cols'] = [];\n        for (let i = 0; i < this.columnData.length; i++) {\n          worksheet['!cols'][i] = {\n            wch: 20\n          };\n        }\n        excelHeaders = this.columnData.map(obj => obj['header']);\n        const headers = excelHeaders.map((header, index) => ({\n          v: header,\n          position: String.fromCharCode(65 + index) + 1\n        }));\n        headers.forEach(header => {\n          worksheet[header.position] = {\n            v: header.v\n          };\n        });\n        const workbook = {\n          Sheets: {\n            'data': worksheet\n          },\n          SheetNames: ['data']\n        };\n        const excelBuffer = xlsx.write(workbook, {\n          bookType: 'xlsx',\n          type: 'array'\n        });\n        this.saveAsExcelFile(excelBuffer, \"occupancy_statistics\");\n      });\n    }\n    getDestructuredData(data) {\n      this.grid_array = data.map(item => {\n        let obj = {};\n        if (this.filterData.division) {\n          obj[\"Division\"] = item['division'];\n        }\n        if (this.filterData.department) {\n          obj[\"Department\"] = item['department'];\n        }\n        if (this.filterData.building) {\n          obj[\"Building\"] = item['building'];\n        }\n        if (this.filterData.floor) {\n          obj[\"Floor\"] = item['floor'];\n        }\n        obj[\"Total Seats\"] = item['totalSpace'];\n        obj[\"Occupied Seats\"] = item['occupiedSpace'];\n        obj[\"Available Seats\"] = item['availableSpace'];\n        obj[\"Occupancy (%)\"] = item['occupiedPercentage'];\n        return obj;\n      });\n    }\n    saveAsExcelFile(buffer, fileName) {\n      let EXCEL_TYPE = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';\n      let EXCEL_EXTENSION = '.xlsx';\n      const data = new Blob([buffer], {\n        type: EXCEL_TYPE\n      });\n      FileSaver.saveAs(data, fileName + '_export_' + new Date().getTime() + EXCEL_EXTENSION);\n    }\n    onClickCount(data) {\n      this.showPopUpGrid = false;\n      let obj = {};\n      if (data.division) {\n        obj.divId = data.division;\n      }\n      if (data.department) {\n        obj.depId = data.department;\n      }\n      if (data.building) {\n        obj.blId = data.building;\n      }\n      if (data.floor) {\n        obj.flId = data.floor;\n      }\n      if (this.filterData.division) {\n        obj.division = true;\n      } else {\n        obj.division = false;\n      }\n      if (this.filterData.department) {\n        obj.department = true;\n      } else {\n        obj.department = false;\n      }\n      if (this.filterData.building) {\n        obj.building = true;\n      } else {\n        obj.building = false;\n      }\n      if (this.filterData.floor) {\n        obj.floor = true;\n      } else {\n        obj.floor = false;\n      }\n      this.blService.getspaceutilizationrmdata(obj).subscribe(res => {\n        this.roomData = res;\n        this.showPopUpGrid = true;\n      });\n    }\n    static #_ = this.ɵfac = function ViewOccupancyStatisticsComponent_Factory(t) {\n      return new (t || ViewOccupancyStatisticsComponent)(i0.ɵɵdirectiveInject(i1.EmployeeService), i0.ɵɵdirectiveInject(i2.BuildingService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ViewOccupancyStatisticsComponent,\n      selectors: [[\"app-view-occupancy-statistics\"]],\n      decls: 24,\n      vars: 6,\n      consts: [[1, \"card\", \"checkbox-cont\"], [2, \"display\", \"flex\"], [2, \"margin-left\", \"10px\"], [\"name\", \"group1\", \"value\", \"division\", \"inputId\", \"div\", 1, \"select-box\", 3, \"ngModel\", \"ngModelChange\", \"onChange\"], [\"for\", \"div\"], [\"name\", \"group1\", \"value\", \"department\", \"inputId\", \"dep\", 1, \"select-box\", 3, \"ngModel\", \"ngModelChange\", \"onChange\"], [\"for\", \"dep\"], [\"name\", \"group1\", \"value\", \"building\", \"inputId\", \"bl\", 1, \"select-box\", 3, \"ngModel\", \"ngModelChange\", \"onChange\"], [\"for\", \"bl\"], [\"name\", \"group1\", \"value\", \"floor\", \"inputId\", \"fl\", 1, \"select-box\", 3, \"ngModel\", \"ngModelChange\", \"onChange\"], [\"for\", \"fl\"], [2, \"margin-right\", \"10px\"], [\"pButton\", \"\", \"pRipple\", \"\", \"label\", \"Clear\", 1, \"p-button-primary\", \"p-button-sm\", \"pull\", \"right\", 2, \"width\", \"60px\", \"margin-left\", \"5px\", 3, \"click\"], [\"type\", \"button\", \"pButton\", \"\", \"pRipple\", \"\", \"icon\", \"pi pi-file-excel\", \"matTooltip\", \"XLS\", \"matTooltipPosition\", \"below\", 1, \"p-button-success\", \"p-mr-2\", \"pull-right\", 2, \"margin-left\", \"5px\", 3, \"disabled\", \"click\"], [\"class\", \"card\", \"style\", \"height:610px;\", 4, \"ngIf\"], [1, \"card\", 2, \"height\", \"610px\"], [\"scrollDirection\", \"both\", \"scrollHeight\", \"560px\", \"currentPageReportTemplate\", \"Showing {first} to {last} of {totalRecords} entries\", \"styleClass\", \"p-datatable-responsive-demo p-datatable-gridlines\", 3, \"columns\", \"paginator\", \"rows\", \"scrollable\", \"showCurrentPageReport\", \"rowsPerPageOptions\", \"value\", \"loading\", \"rowHover\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"body\"], [\"pTemplate\", \"emptymessage\"], [\"styleClass\", \"dark-panel\", 3, \"visible\", \"modal\", \"maximizable\", \"draggable\", \"resizable\", \"visibleChange\"], [\"style\", \"min-width:40px\", 4, \"ngFor\", \"ngForOf\"], [2, \"min-width\", \"40px\"], [2, \"cursor\", \"pointer\", 3, \"click\"], [2, \"margin\", \"0px\"], [3, \"data\"]],\n      template: function ViewOccupancyStatisticsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2);\n          i0.ɵɵtext(3, \" View By \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"div\", 2)(5, \"p-checkbox\", 3);\n          i0.ɵɵlistener(\"ngModelChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_ngModelChange_5_listener($event) {\n            return ctx.selectedOptions = $event;\n          })(\"onChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_onChange_5_listener($event) {\n            return ctx.checkboxSelected($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"label\", 4);\n          i0.ɵɵtext(7, \"Division\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(8, \"div\", 2)(9, \"p-checkbox\", 5);\n          i0.ɵɵlistener(\"ngModelChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_ngModelChange_9_listener($event) {\n            return ctx.selectedOptions = $event;\n          })(\"onChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_onChange_9_listener($event) {\n            return ctx.checkboxSelected($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(10, \"label\", 6);\n          i0.ɵɵtext(11, \"Department\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(12, \"div\", 2)(13, \"p-checkbox\", 7);\n          i0.ɵɵlistener(\"ngModelChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_ngModelChange_13_listener($event) {\n            return ctx.selectedOptions = $event;\n          })(\"onChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_onChange_13_listener($event) {\n            return ctx.checkboxSelected($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"label\", 8);\n          i0.ɵɵtext(15, \"Building\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(16, \"div\", 2)(17, \"p-checkbox\", 9);\n          i0.ɵɵlistener(\"ngModelChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_ngModelChange_17_listener($event) {\n            return ctx.selectedOptions = $event;\n          })(\"onChange\", function ViewOccupancyStatisticsComponent_Template_p_checkbox_onChange_17_listener($event) {\n            return ctx.checkboxSelected($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(18, \"label\", 10);\n          i0.ɵɵtext(19, \"Floor\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(20, \"div\", 11)(21, \"button\", 12);\n          i0.ɵɵlistener(\"click\", function ViewOccupancyStatisticsComponent_Template_button_click_21_listener() {\n            return ctx.onClear();\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(22, \"button\", 13);\n          i0.ɵɵlistener(\"click\", function ViewOccupancyStatisticsComponent_Template_button_click_22_listener() {\n            return ctx.exportExcel();\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵtemplate(23, ViewOccupancyStatisticsComponent_div_23_Template, 8, 18, \"div\", 14);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngModel\", ctx.selectedOptions);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.selectedOptions);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.selectedOptions);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.selectedOptions);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"disabled\", ctx.selectedOptions.length == 0);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.showTable);\n        }\n      },\n      dependencies: [i3.NgForOf, i3.NgIf, i4.NgControlStatus, i4.NgModel, i5.NzTableCellDirective, i5.NzThMeasureDirective, i5.NzTrDirective, i6.PrimeTemplate, i7.Table, i8.ButtonDirective, i9.Dialog, i10.Checkbox, i11.MatTooltip, i12.AddRoomStatisticsReportTableComponent],\n      styles: [\".checkbox-cont[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;height:50px}.select-box[_ngcontent-%COMP%]{margin-right:5px}p-dialog[_ngcontent-%COMP%]{z-index:1000}  .p-dialog .p-dialog-header{padding:10px!important}\"]\n    });\n  }\n  return ViewOccupancyStatisticsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}