{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { MessageService } from 'primeng/api';\nimport { forkJoin, of } from 'rxjs';\nimport { UtilConstant } from 'src/common/UtilConstant';\nimport { AddPlanStepsFormComponent } from '../../add-plan-steps/add-plan-steps-form.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"primeng/api\";\nimport * as i3 from \"../../../services/ppm-plan-services\";\nimport * as i4 from \"primeng/button\";\nimport * as i5 from \"primeng/toast\";\nimport * as i6 from \"primeng/confirmdialog\";\nimport * as i7 from \"@angular/material/legacy-card\";\nimport * as i8 from \"../../add-plan-steps/add-plan-steps-form.component\";\nexport let AddEditPlanStepsComponent = /*#__PURE__*/(() => {\n  class AddEditPlanStepsComponent {\n    constructor(formBuilder, confirmationService, ppmPlanService, messageService) {\n      this.formBuilder = formBuilder;\n      this.confirmationService = confirmationService;\n      this.ppmPlanService = ppmPlanService;\n      this.messageService = messageService;\n      this.subscriptions = [];\n      this.isNew = true;\n      this.isEdit = true;\n      this.opertation_title = \"\";\n      this.parentFun = new EventEmitter();\n      this.formPPmDetail = this.formBuilder.group({\n        planStepFormPanel: []\n      });\n    }\n    ngOnInit() {}\n    isNewRecord() {\n      if (this.data.newRecord != null) {\n        this.isNew = this.data.newRecord;\n      }\n    }\n    loadData(planId, planStepId) {\n      const calls = [];\n      if (planStepId) {\n        calls.push(this.ppmPlanService.getPlanStepById(planStepId));\n      } else {\n        calls.push(of(null));\n      }\n      forkJoin(...calls).subscribe(results => {\n        if (results[0] == null) {\n          let planStepData = {\n            planStepId: null,\n            planId: planId,\n            stepCode: null,\n            instructions: null\n          };\n          setTimeout(() => {\n            this.addPlanStepsFormComponent.loadPlansData();\n            this.formPPmDetail.patchValue({\n              planStepFormPanel: planStepData\n            });\n          }, 0);\n        } else {\n          setTimeout(() => {\n            this.addPlanStepsFormComponent.prevPlanId = results[0].planId;\n            this.addPlanStepsFormComponent.prevStepCode = results[0].stepCode;\n            this.formPPmDetail.patchValue({\n              planStepFormPanel: results[0]\n            });\n          }, 0);\n        }\n      });\n    }\n    saveRecords() {\n      if (this.formPPmDetail.valid) {\n        const planStepData = this.formPPmDetail.controls.planStepFormPanel.value;\n        this.ppmPlanService.savePlanStep(planStepData).subscribe(res => {\n          if (res.stepCode) {\n            this.setPlanStepId(res);\n          } else {\n            this.messageService.add({\n              key: 'error',\n              severity: 'error',\n              summary: 'error',\n              detail: res.text\n            });\n          }\n        }, error => {});\n      }\n    }\n    confirmDialog() {\n      this.confirmationService.confirm({\n        message: UtilConstant.CANCEL_Msg,\n        header: 'Confirmation',\n        icon: 'pi pi-exclamation-triangle',\n        accept: () => {}\n      });\n    }\n    setPlanStepId(planId) {\n      this.parentFun.emit(planId);\n    }\n    static #_ = this.ɵfac = function AddEditPlanStepsComponent_Factory(t) {\n      return new (t || AddEditPlanStepsComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ConfirmationService), i0.ɵɵdirectiveInject(i3.PpmPlanService), i0.ɵɵdirectiveInject(i2.MessageService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddEditPlanStepsComponent,\n      selectors: [[\"app-add-edit-plan-steps\"]],\n      viewQuery: function AddEditPlanStepsComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(AddPlanStepsFormComponent, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.addPlanStepsFormComponent = _t.first);\n        }\n      },\n      inputs: {\n        data: \"data\"\n      },\n      outputs: {\n        parentFun: \"parentFun\"\n      },\n      features: [i0.ɵɵProvidersFeature([MessageService])],\n      decls: 9,\n      vars: 3,\n      consts: [[1, \"card\"], [3, \"formGroup\"], [\"id\", \"Frm\"], [\"formControlName\", \"planStepFormPanel\", 3, \"isNew\"], [2, \"display\", \"flex\", \"justify-content\", \"end\", \"margin-top\", \"5px\"], [\"label\", \"Save\", \"icon\", \"pi pi-check\", 3, \"disabled\", \"click\"], [\"header\", \"Confirmation\", \"icon\", \"pi pi-exclamation-triangle\"], [\"key\", \"error\", \"position\", \"top-right\"]],\n      template: function AddEditPlanStepsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"form\", 1)(2, \"mat-card\")(3, \"mat-card-content\", 2);\n          i0.ɵɵelement(4, \"app-add-plan-steps-form\", 3);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(5, \"div\", 4)(6, \"p-button\", 5);\n          i0.ɵɵlistener(\"click\", function AddEditPlanStepsComponent_Template_p_button_click_6_listener() {\n            return ctx.saveRecords();\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(7, \"p-confirmDialog\", 6)(8, \"p-toast\", 7);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"formGroup\", ctx.formPPmDetail);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"isNew\", ctx.isNew);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", !ctx.formPPmDetail.valid);\n        }\n      },\n      dependencies: [i4.Button, i5.Toast, i6.ConfirmDialog, i1.ɵNgNoValidate, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i7.MatLegacyCard, i7.MatLegacyCardContent, i8.AddPlanStepsFormComponent]\n    });\n  }\n  return AddEditPlanStepsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}