{"ast":null,"code":"import { MessageService } from 'primeng/api';\nimport { AddEqFormComponent } from '../widgets/add-equipment/add-eq-form/add-eq-form.component';\nimport { DocumentsListComponent } from 'src/app/ui/documents-list/modal/documents-list.component';\nimport { forkJoin, of } from 'rxjs';\nimport { UtilConstant } from 'src/common/UtilConstant';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../services/equipment.services\";\nimport * as i3 from \"primeng/api\";\nimport * as i4 from \"../../eq-std/providers/eq-std.provider\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"@angular/material/dialog\";\nimport * as i8 from \"@angular/material/legacy-card\";\nimport * as i9 from \"primeng/button\";\nimport * as i10 from \"primeng/toast\";\nimport * as i11 from \"primeng/panel\";\nimport * as i12 from \"primeng/confirmdialog\";\nimport * as i13 from \"primeng/tabview\";\nimport * as i14 from \"../../../documents-list/modal/documents-list.component\";\nimport * as i15 from \"../widgets/asset-warranty/asset-warranty.component\";\nimport * as i16 from \"../widgets/asset-location/asset-location.component\";\nimport * as i17 from \"../widgets/asset-lease/asset-lease.component\";\nimport * as i18 from \"../widgets/asset-insurance/asset-insurance.component\";\nimport * as i19 from \"../widgets/add-equipment/add-eq-form/add-eq-form.component\";\nconst _c0 = [\"detailsAccordionTab\"];\nconst _c1 = [\"Accordion\"];\nconst _c2 = function () {\n  return {\n    \"margin-left\": \".5em\"\n  };\n};\nfunction AssetDetailsComponent_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"p-button\", 32);\n    i0.ɵɵlistener(\"click\", function AssetDetailsComponent_ng_template_2_Template_p_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.saveRecords());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(1, \"p-button\", 33);\n    i0.ɵɵlistener(\"click\", function AssetDetailsComponent_ng_template_2_Template_p_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.clickBack());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"disabled\", !ctx_r0.frmEqDetail.valid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵstyleMap(i0.ɵɵpureFunction0(3, _c2));\n  }\n}\nfunction AssetDetailsComponent_ng_template_47_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 34);\n    i0.ɵɵlistener(\"click\", function AssetDetailsComponent_ng_template_47_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      i0.ɵɵnextContext();\n      const _r5 = i0.ɵɵreference(46);\n      return i0.ɵɵresetView(_r5.reject());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(1, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function AssetDetailsComponent_ng_template_47_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r11);\n      i0.ɵɵnextContext();\n      const _r5 = i0.ɵɵreference(46);\n      return i0.ɵɵresetView(_r5.accept());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c3 = function () {\n  return {\n    width: \"25vw\"\n  };\n};\nexport let AssetDetailsComponent = /*#__PURE__*/(() => {\n  class AssetDetailsComponent {\n    constructor(\n    // @Inject(MAT_DIALOG_DATA) public data: any,\n    formBuilder,\n    // public dialog: MatDialog,\n    // public dialogRef: MatDialogRef<AddEditEqFormComponent>,\n    eqService, confirmationService, messageService, eqStdProvider, datePipe, router, route) {\n      this.formBuilder = formBuilder;\n      this.eqService = eqService;\n      this.confirmationService = confirmationService;\n      this.messageService = messageService;\n      this.eqStdProvider = eqStdProvider;\n      this.datePipe = datePipe;\n      this.router = router;\n      this.route = route;\n      this.isNew = true;\n      this.isEdit = true;\n      this.title = 'Add';\n      this.index = 0;\n      this.selectedTab = '';\n      this.docBucketId = 0;\n      this.eqId = 0;\n      this.data = {\n        eqId: null\n      };\n      this.activeIndex = 0;\n      this.listTabs = [\"Details\", \"Location\", \"Insurance\", \"Lease\", \"Warranty\", \"Documents\"];\n      this.frmEqDetail = this.formBuilder.group({\n        eqFormPanel: [],\n        eqLocationPanel: [],\n        eqInsurance: [],\n        eqLease: [],\n        eqWarranty: []\n      });\n      this.route.queryParams.subscribe(params => {\n        if (params.eqId != null) {\n          this.data.eqId = params.eqId;\n        } else {\n          this.data.eqId = null;\n        }\n      });\n    }\n    ngOnInit() {\n      this.isEdit = true;\n      this.isNew = true;\n      if (this.data != null) {\n        this.loadData();\n        this.isNewRecord();\n      }\n      setTimeout(() => {\n        this.setDetailsAccordionOpen();\n      });\n    }\n    setDetailsAccordionOpen() {\n      if (this.detailsAccordionTab) {\n        // Close all tabs\n        this.accordion.tabs.forEach(tab => {\n          tab.selected = false;\n        });\n        // Open the \"Details\" accordion tab\n        this.detailsAccordionTab.selected = true;\n      }\n    }\n    isNewRecord() {\n      if (this.data.eqId != null) {\n        this.isNew = false;\n        if (!this.isNew) {\n          this.title = 'Edit';\n        }\n      }\n    }\n    loadData() {\n      const calls = [];\n      if (this.data.eqId != null) {\n        calls.push(this.eqService.getEquipmentById(this.data.eqId));\n      } else {\n        calls.push(of(null));\n      }\n      forkJoin(...calls).subscribe(results => {\n        if (results[0] == null) {\n          this.eqId = 0;\n          var eqData = {\n            eqId: 0,\n            eqCode: null,\n            eqStd: null,\n            blId: null,\n            flId: null,\n            rmId: null,\n            status: null,\n            description: null,\n            svgElementId: null,\n            docBucketId: null\n          };\n          setTimeout(() => {\n            this.frmEqDetail.patchValue({\n              eqFormPanel: eqData,\n              eqLocationPanel: eqData\n            });\n          }, 0);\n        } else {\n          this.eqId = results[0].eqId;\n          this.addEqFormPanel.presentEquipment = results[0].eqId;\n          this.docBucketId = results[0].docBucketId || 0;\n          setTimeout(() => {\n            this.frmEqDetail.patchValue({\n              eqFormPanel: results[0],\n              eqLocationPanel: results[0],\n              eqInsurance: results[0],\n              eqLease: results[0],\n              eqWarranty: results[0]\n            });\n          }, 0);\n        }\n      });\n    }\n    saveRecords() {\n      if (this.frmEqDetail.valid) {\n        const eqDetails = this.frmEqDetail.controls.eqFormPanel.value;\n        eqDetails.eqId = this.eqId;\n        const eqLocation = this.frmEqDetail.controls.eqLocationPanel.value;\n        const eqInsurance = this.frmEqDetail.controls.eqInsurance.value;\n        const eqLease = this.frmEqDetail.controls.eqLease.value;\n        const eqWarranty = this.frmEqDetail.controls.eqWarranty.value;\n        const eqData = {\n          ...eqDetails,\n          ...eqLocation,\n          ...eqInsurance,\n          ...eqLease,\n          ...eqWarranty\n        };\n        eqData.manfDate = eqData.manfDate ? this.datePipe.transform(eqData.manfDate, \"yyyy-MM-dd\") : null;\n        eqData.dateInstalled = eqData.dateInstalled ? this.datePipe.transform(eqData.dateInstalled, \"yyyy-MM-dd\") : null;\n        eqData.dateDisposed = eqData.dateDisposed ? this.datePipe.transform(eqData.dateDisposed, \"yyyy-MM-dd\") : null;\n        eqData.dateSold = eqData.dateSold ? this.datePipe.transform(eqData.dateSold, \"yyyy-MM-dd\") : null;\n        eqData.datePurchase = eqData.datePurchase ? this.datePipe.transform(eqData.datePurchase, \"yyyy-MM-dd\") : null;\n        eqData.leaseFromDate = eqData.leaseFromDate ? this.datePipe.transform(eqData.leaseFromDate, \"yyyy-MM-dd\") : null;\n        eqData.leaseToDate = eqData.leaseToDate ? this.datePipe.transform(eqData.leaseToDate, \"yyyy-MM-dd\") : null;\n        eqData.insuranceFromDate = eqData.insuranceFromDate ? this.datePipe.transform(eqData.insuranceFromDate, \"yyyy-MM-dd\") : null;\n        eqData.insuranceToDate = eqData.insuranceToDate ? this.datePipe.transform(eqData.insuranceToDate, \"yyyy-MM-dd\") : null;\n        eqData.warrantyFromDate = eqData.warrantyFromDate ? this.datePipe.transform(eqData.warrantyFromDate, \"yyyy-MM-dd\") : null;\n        eqData.warrantyToDate = eqData.warrantyToDate ? this.datePipe.transform(eqData.warrantyToDate, \"yyyy-MM-dd\") : null;\n        eqData.docBucketId = this.docBucketId ? this.docBucketId : null;\n        this.messageService.clear();\n        this.eqService.saveEquipment(eqData).subscribe(res => {\n          if (res.eqId) {\n            this.messageService.add({\n              key: 'eqSave',\n              severity: 'success',\n              summary: 'Record saved successfully',\n              detail: 'Record saved successfully'\n            });\n            this.eqId = res.eqId;\n            this.addEqFormPanel.presentEquipment = res.eqId;\n          } else {\n            this.messageService.add({\n              key: 'error',\n              severity: 'error',\n              summary: 'error',\n              detail: res.text\n            });\n          }\n        }, error => {});\n      }\n    }\n    confirmDialog() {\n      this.confirmationService.confirm({\n        message: UtilConstant.CANCEL_Msg,\n        header: 'Confirmation',\n        icon: 'pi pi-exclamation-triangle',\n        accept: () => {\n          // this.dialogRef.close(false);\n        },\n        key: \"positionDialog\"\n      });\n    }\n    handleChange(event) {\n      if (event != null) {\n        this.index = event.index;\n        this.selectedTab = event.originalEvent.target.innerText;\n      }\n      switch (this.selectedTab) {\n        case \"Details\":\n          this.data.eqId = this.eqId;\n          this.loadData();\n          break;\n        case \"Documents\":\n          this.documentsListComponent.data = {\n            tableName: 'eq',\n            fieldName: 'doc_bucket_id',\n            pkField: 'eq_id',\n            docBucketId: this.docBucketId,\n            pkValue: this.addEqFormPanel.presentEquipment\n          };\n          this.documentsListComponent.loadDocumentsByDocBucketId(this.docBucketId);\n          break;\n      }\n    }\n    confirmDoc() {\n      this.confirmationService.confirm({\n        message: 'Asset saved successfully! Would you like to add \"Documents\"?',\n        accept: () => {\n          const event = {\n            index: 1,\n            originalEvent: {\n              target: {\n                innerText: 'Documents'\n              }\n            }\n          };\n          this.handleChange(event);\n        },\n        reject: type => {\n          // this.dialogRef.close(true);\n        },\n        key: \"confirmDialog\"\n      });\n    }\n    clickBack() {\n      this.router.navigate(['/asset']);\n    }\n    static #_ = this.ɵfac = function AssetDetailsComponent_Factory(t) {\n      return new (t || AssetDetailsComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.EquipmentService), i0.ɵɵdirectiveInject(i3.ConfirmationService), i0.ɵɵdirectiveInject(i3.MessageService), i0.ɵɵdirectiveInject(i4.EqStdDialogueProvider), i0.ɵɵdirectiveInject(i5.DatePipe), i0.ɵɵdirectiveInject(i6.Router), i0.ɵɵdirectiveInject(i6.ActivatedRoute));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AssetDetailsComponent,\n      selectors: [[\"app-asset-details\"]],\n      viewQuery: function AssetDetailsComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(AddEqFormComponent, 5);\n          i0.ɵɵviewQuery(DocumentsListComponent, 5);\n          i0.ɵɵviewQuery(_c0, 5);\n          i0.ɵɵviewQuery(_c1, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.addEqFormPanel = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.documentsListComponent = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.detailsAccordionTab = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.accordion = _t.first);\n        }\n      },\n      features: [i0.ɵɵProvidersFeature([MessageService])],\n      decls: 48,\n      vars: 17,\n      consts: [[1, \"card\", 2, \"height\", \"90vh !important\"], [3, \"header\"], [\"pTemplate\", \"icons\"], [3, \"activeIndex\", \"activeIndexChange\", \"onChange\"], [\"header\", \"Basic Details\"], [\"details\", \"\"], [1, \"mat-typography\", \"mat-dialog-content-ext\"], [3, \"formGroup\"], [\"id\", \"equipment\"], [\"formControlName\", \"eqFormPanel\", 3, \"isNew\"], [\"header\", \"Other Details\"], [\"location\", \"\"], [\"id\", \"eqLocationPanel\"], [\"formControlName\", \"eqLocationPanel\", 3, \"isNew\"], [\"header\", \"Insurance, Lease and Warranty\"], [\"insurance\", \"\"], [1, \"section\"], [\"id\", \"eqInsurance\"], [\"formControlName\", \"eqInsurance\", 3, \"isNew\"], [\"id\", \"eqLease\"], [\"formControlName\", \"eqLease\", 3, \"isNew\"], [\"id\", \"eqWarranty\"], [\"formControlName\", \"eqWarranty\", 3, \"isNew\"], [\"header\", \"Documents\", 3, \"disabled\"], [\"document\", \"\"], [3, \"docBucketId\"], [\"key\", \"eqSave\", \"position\", \"top-right\"], [\"key\", \"error\", \"position\", \"top-right\"], [\"key\", \"positionDialog\", \"header\", \"Confirmation\", \"icon\", \"pi pi-exclamation-triangle\"], [\"key\", \"confirmDialog\", \"header\", \"Confirmation\", \"icon\", \"pi pi-exclamation-triangle\"], [\"cd\", \"\"], [\"pTemplate\", \"footer\"], [\"label\", \"Save\", \"icon\", \"pi pi-check\", 3, \"disabled\", \"click\"], [\"label\", \"Back\", \"icon\", \"pi pi-arrow-circle-left\", \"styleClass\", \"p-button-secondary\", 3, \"click\"], [\"type\", \"button\", \"pButton\", \"\", \"icon\", \"pi pi-times\", \"label\", \"No\", 3, \"click\"], [\"type\", \"button\", \"pButton\", \"\", \"icon\", \"pi pi-check\", \"label\", \"Yes\", 3, \"click\"]],\n      template: function AssetDetailsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"p-panel\", 1);\n          i0.ɵɵtemplate(2, AssetDetailsComponent_ng_template_2_Template, 2, 4, \"ng-template\", 2);\n          i0.ɵɵelementStart(3, \"p-tabView\", 3);\n          i0.ɵɵlistener(\"activeIndexChange\", function AssetDetailsComponent_Template_p_tabView_activeIndexChange_3_listener($event) {\n            return ctx.index = $event;\n          })(\"onChange\", function AssetDetailsComponent_Template_p_tabView_onChange_3_listener($event) {\n            return ctx.handleChange($event);\n          });\n          i0.ɵɵelementStart(4, \"p-tabPanel\", 4, 5)(6, \"mat-dialog-content\", 6)(7, \"form\", 7)(8, \"mat-card-content\", 8);\n          i0.ɵɵelement(9, \"app-add-eq-form\", 9);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(10, \"p-tabPanel\", 10, 11)(12, \"mat-dialog-content\", 6)(13, \"form\", 7)(14, \"mat-card-content\", 12);\n          i0.ɵɵelement(15, \"app-asset-location\", 13);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(16, \"p-tabPanel\", 14, 15)(18, \"mat-dialog-content\", 6)(19, \"div\", 16)(20, \"h3\");\n          i0.ɵɵtext(21, \"Insurance\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(22, \"form\", 7)(23, \"mat-card-content\", 17);\n          i0.ɵɵelement(24, \"app-asset-insurance\", 18);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(25, \"mat-dialog-content\", 6)(26, \"div\", 16)(27, \"h3\");\n          i0.ɵɵtext(28, \"Lease\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"form\", 7)(30, \"mat-card-content\", 19);\n          i0.ɵɵelement(31, \"app-asset-lease\", 20);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(32, \"mat-dialog-content\", 6)(33, \"div\", 16)(34, \"h3\");\n          i0.ɵɵtext(35, \"Warranty\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(36, \"form\", 7)(37, \"mat-card-content\", 21);\n          i0.ɵɵelement(38, \"app-asset-warranty\", 22);\n          i0.ɵɵelementEnd()()()()();\n          i0.ɵɵelementStart(39, \"p-tabPanel\", 23, 24);\n          i0.ɵɵelement(41, \"app-documents-list\", 25);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelement(42, \"p-toast\", 26)(43, \"p-toast\", 27)(44, \"p-confirmDialog\", 28);\n          i0.ɵɵelementStart(45, \"p-confirmDialog\", 29, 30);\n          i0.ɵɵtemplate(47, AssetDetailsComponent_ng_template_47_Template, 2, 0, \"ng-template\", 31);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(1);\n          i0.ɵɵpropertyInterpolate1(\"header\", \"\", ctx.title, \" Asset\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"activeIndex\", ctx.index);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"formGroup\", ctx.frmEqDetail);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"isNew\", ctx.isNew);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"formGroup\", ctx.frmEqDetail);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"isNew\", ctx.isNew);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"formGroup\", ctx.frmEqDetail);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"isNew\", ctx.isNew);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"formGroup\", ctx.frmEqDetail);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"isNew\", ctx.isNew);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"formGroup\", ctx.frmEqDetail);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"isNew\", ctx.isNew);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"disabled\", ctx.eqId == 0);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"docBucketId\", ctx.docBucketId);\n          i0.ɵɵadvance(4);\n          i0.ɵɵstyleMap(i0.ɵɵpureFunction0(16, _c3));\n        }\n      },\n      dependencies: [i1.ɵNgNoValidate, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i7.MatDialogContent, i8.MatLegacyCardContent, i3.PrimeTemplate, i9.ButtonDirective, i9.Button, i10.Toast, i11.Panel, i12.ConfirmDialog, i13.TabView, i13.TabPanel, i14.DocumentsListComponent, i15.AssetWarrantyComponent, i16.AssetLocationComponent, i17.AssetLeaseComponent, i18.AssetInsuranceComponent, i19.AddEqFormComponent],\n      styles: [\".container[_ngcontent-%COMP%]{background-color:#fff;padding:5px;border-radius:3px;box-shadow:0 4px 8px #0000001a;transition:transform .3s ease-in-out}.container[_ngcontent-%COMP%]:hover{transform:scale(1)}.section-title[_ngcontent-%COMP%]{font-size:14px;font-weight:700;margin-bottom:10px;border-bottom:1px solid #ccc}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li.p-highlight .p-tabview-nav-link{background:#ffffff;border-color:#879cc9;color:#000;margin-right:2px;line-height:2.35;min-width:80px;border-radius:6px 6px 0 0;border-bottom:3px solid #879cc9!important;box-shadow:none!important}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li .p-tabview-nav-link{border-color:#879cc9;background:#879cc9;color:#fff;margin-right:2px;line-height:2.35;min-width:80px;border-radius:6px 6px 0 0;border-bottom:3px solid #879cc9!important;box-shadow:none!important}h3[_ngcontent-%COMP%]{margin-bottom:0;padding-left:3px}.section[_ngcontent-%COMP%]{margin:5px}\"]\n    });\n  }\n  return AssetDetailsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}