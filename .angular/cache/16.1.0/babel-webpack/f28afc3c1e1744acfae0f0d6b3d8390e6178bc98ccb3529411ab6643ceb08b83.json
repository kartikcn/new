{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { UtilConstant } from 'src/common/UtilConstant';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../../service/inventory.service\";\nimport * as i3 from \"primeng/api\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"src/app/services/auth.service\";\nimport * as i6 from \"src/app/ui/background-loc/services/bl.service\";\nimport * as i7 from \"primeng/button\";\nimport * as i8 from \"primeng/dialog\";\nimport * as i9 from \"primeng/toast\";\nimport * as i10 from \"../../../../../directive/numbers-only.directive\";\nimport * as i11 from \"@ng-select/ng-select\";\nconst _c0 = function () {\n  return {\n    \"margin-left\": \".5em\"\n  };\n};\nfunction AddEditCenterBudgetComponent_ng_template_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function AddEditCenterBudgetComponent_ng_template_32_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.saveRecords());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(1, \"p-button\", 16);\n    i0.ɵɵlistener(\"click\", function AddEditCenterBudgetComponent_ng_template_32_Template_p_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.onCancel());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.formCenterBudget.invalid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵstyleMap(i0.ɵɵpureFunction0(3, _c0));\n  }\n}\nconst _c1 = function () {\n  return {\n    minHeight: \"38vh\",\n    width: \"42vw\"\n  };\n};\nconst _c2 = function () {\n  return {\n    \"1199px\": \"30vw\",\n    \"767px\": \"50vw\",\n    \"575px\": \"70vw\"\n  };\n};\nexport let AddEditCenterBudgetComponent = /*#__PURE__*/(() => {\n  class AddEditCenterBudgetComponent {\n    constructor(fb, inventorySrv, messageService, datePipe, auth, blServ) {\n      this.fb = fb;\n      this.inventorySrv = inventorySrv;\n      this.messageService = messageService;\n      this.datePipe = datePipe;\n      this.auth = auth;\n      this.blServ = blServ;\n      this.parentFun = new EventEmitter();\n      this.showDialogue = true;\n      this.subscriptions = [];\n      this.budgetTermList = [];\n      this.blIdList = [];\n      this.flIdList = [];\n      this.itemList = [];\n      this.title = 'Add';\n      this.isNew = false;\n      this.currentDate = '';\n      this.userId = 0;\n      this.limitBl = 0;\n      this.offsetBl = 0;\n      this.limitFl = 0;\n      this.offsetFl = 0;\n      this.filterCriteria = {\n        fieldName: null,\n        value: null,\n        matchMode: 'contains',\n        limit: 0,\n        offset: 0\n      };\n      this.selectedBl = {};\n      this.selectedFl = {};\n      this.scrollLimit = UtilConstant.SCROLL_LIMIT;\n      this.onChange = () => {};\n      this.onTouched = () => {};\n      this.formCenterBudget = fb.group({\n        centerBudgetId: [0],\n        budgetTermId: [null, Validators.required],\n        blId: [null, Validators.required],\n        flId: [null, Validators.required],\n        itemId: [null, Validators.required],\n        budget: [0, Validators.required],\n        enteredBy: [null],\n        enteredDate: [null]\n      });\n      this.subscriptions.push(this.formCenterBudget.valueChanges.subscribe(value => {\n        this.onChange(value);\n        this.onTouched();\n      }));\n    }\n    ngOnInit() {\n      this.currentDate = this.datePipe.transform(new Date(), 'yyyy-MM-dd hh:mm');\n      this.userId = this.auth.getLoggedInUserId();\n      this.formCenterBudget.patchValue({\n        enteredBy: this.userId,\n        enteredDate: this.currentDate\n      });\n      this.isNew = this.centerBudgetData.isNew;\n      this.loadCenterBudgetId(this.centerBudgetData.centerBudgetId);\n      this.loadEnumList();\n      if (!this.isNew) this.title = 'Edit';\n    }\n    loadCenterBudgetId(id) {\n      if (id != 0) {\n        this.inventorySrv.getCenterBudgetById(id).subscribe(res => {\n          if (res && !res.code) {\n            this.formCenterBudget.patchValue({\n              centerBudgetId: res.centerBudgetId,\n              budgetTermId: res.budgetTermId,\n              blId: res.blId,\n              flId: res.flId,\n              itemId: res.itemId,\n              budget: res.budget,\n              enteredBy: res.enteredBy,\n              enteredDate: res.enteredDate\n            });\n            this.scrollToEndBl();\n            this.scrollToEndFl();\n          }\n        });\n      }\n    }\n    loadEnumList() {\n      this.inventorySrv.getAllBudegetTerm().subscribe(res => {\n        this.budgetTermList = res && !res.code ? res : [];\n      });\n      this.inventorySrv.getAllItems().subscribe(res => {\n        this.itemList = res && !res.code ? res : [];\n      });\n    }\n    onSelectBlCode($event) {\n      setTimeout(() => {\n        this.formCenterBudget.patchValue({\n          flId: null\n        });\n      }, 10);\n      if ($event.blId != null) {\n        this.selectedBl = $event;\n        this.selectedFl = {};\n      } else {\n        this.selectedBl = {};\n        this.selectedFl = {};\n      }\n    }\n    onOpenBl() {\n      this.limitBl = 0;\n      this.offsetBl = 0;\n      this.filterCriteria = {\n        fieldName: null,\n        value: null,\n        matchMode: 'contains',\n        limit: 0,\n        offset: 0\n      };\n      this.scrollToEndBl();\n    }\n    updateBlList(blData) {\n      if (blData.blId) {\n        this.blIdList = this.blIdList.filter(t => t.blId !== blData.blId);\n        this.blIdList = this.blIdList.filter(t => t.blId !== null);\n        this.blIdList.unshift(blData);\n      }\n      this.blIdList.unshift({\n        blId: null,\n        blNameString: 'Make a selection',\n        siteId: null\n      });\n    }\n    scrollToEndBl() {\n      this.offsetBl = this.limitBl;\n      this.limitBl += this.scrollLimit;\n      this.filterCriteria.limit = this.limitBl;\n      this.filterCriteria.offset = this.offsetBl;\n      this.blServ.getALLBuildingByScroll(this.filterCriteria).subscribe(res => {\n        this.blIdList = res;\n        this.updateBlList(this.selectedBl);\n      });\n    }\n    searchBl(event) {\n      this.filterCriteria = {};\n      this.filterCriteria = {\n        fieldName: 'blName',\n        value: event.term,\n        matchMode: 'contains'\n      };\n      this.scrollToEndBl();\n    }\n    searchFl(event) {\n      this.filterCriteria = {};\n      this.filterCriteria = {\n        fieldName: 'flName',\n        value: event.term,\n        matchMode: 'contains'\n      };\n      this.scrollToEndFl();\n    }\n    onSelectFlCode(event) {\n      if (event.flId != null) {\n        const blData = {\n          blId: event.blId,\n          blNameString: event.blNameString,\n          site: null\n        };\n        this.selectedBl = blData;\n        this.updateBlList(blData);\n        setTimeout(() => {\n          this.formCenterBudget.patchValue({\n            blId: event.blId\n          });\n        }, 10);\n      } else {}\n    }\n    scrollToEndFl() {\n      this.offsetFl = this.limitFl;\n      this.limitFl += this.scrollLimit;\n      this.filterCriteria.limit = this.limitFl;\n      this.filterCriteria.offset = this.offsetFl;\n      this.blServ.getALLFloorByScroll(this.filterCriteria).subscribe(res => {\n        this.flIdList = res;\n        this.updateFlList(this.selectedFl);\n      });\n    }\n    updateFlList(flData) {\n      if (flData.flId) {\n        this.flIdList = this.flIdList.filter(t => t.flId !== flData.flId);\n        this.flIdList = this.flIdList.filter(t => t.flId !== null);\n        this.flIdList.unshift(flData);\n      }\n      this.flIdList.unshift({\n        flId: null,\n        flNameString: 'Make a selection',\n        blId: null\n      });\n    }\n    onOpenFl() {\n      this.limitFl = 0;\n      this.offsetFl = 0;\n      if (this.selectedBl.blId) {\n        this.filterCriteria = {\n          fieldName: 'bl.blId',\n          value: this.selectedBl.blId,\n          matchMode: 'equals',\n          limit: 0,\n          offset: 0\n        };\n      } else {\n        this.filterCriteria = {\n          fieldName: null,\n          value: null,\n          matchMode: 'contains',\n          limit: 0,\n          offset: 0\n        };\n      }\n      this.scrollToEndFl();\n    }\n    get value() {\n      const centerBudgetDt = {\n        centerBudgetId: this.formCenterBudget.controls.centerBudgetId.value,\n        budgetTermId: this.formCenterBudget.controls.budgetTermId.value,\n        blId: this.formCenterBudget.controls.blId.value,\n        flId: this.formCenterBudget.controls.flId.value,\n        itemId: this.formCenterBudget.controls.itemId.value,\n        budget: this.formCenterBudget.controls.budget.value,\n        enteredBy: this.formCenterBudget.controls.enteredBy.value,\n        enteredDate: this.formCenterBudget.controls.enteredDate.value\n      };\n      return centerBudgetDt;\n    }\n    set value(value) {\n      setTimeout(() => {\n        this.formCenterBudget.patchValue({\n          centerBudgetId: value.centerBudgetId,\n          budgetTermId: value.budgetTermId,\n          blId: value.blId,\n          flId: value.flId,\n          itemId: value.itemId,\n          budget: value.budget,\n          enteredBy: value.enteredBy,\n          enteredDate: value.enteredDate\n        });\n        this.onChange(value);\n        this.onTouched();\n      }, 0);\n    }\n    saveRecords() {\n      this.messageService.clear();\n      if (this.formCenterBudget.valid) {\n        let centerBudgetDt = {\n          budgetTermId: this.formCenterBudget.controls.budgetTermId.value,\n          blId: this.formCenterBudget.controls.blId.value,\n          flId: this.formCenterBudget.controls.flId.value,\n          itemId: this.formCenterBudget.controls.itemId.value,\n          budget: this.formCenterBudget.controls.budget.value,\n          enteredBy: this.formCenterBudget.controls.enteredBy.value,\n          enteredDate: this.formCenterBudget.controls.enteredDate.value\n        };\n        if (!this.isNew) {\n          centerBudgetDt.centerBudgetId = this.formCenterBudget.controls.centerBudgetId.value;\n        }\n        this.inventorySrv.saveCenterBudget(centerBudgetDt).subscribe(res => {\n          if (res.code == 200) {\n            this.parentFun.emit(res);\n            this.formCenterBudget.reset();\n          } else {\n            this.messageService.add({\n              key: 'save',\n              severity: 'error',\n              summary: 'error',\n              detail: res.text\n            });\n          }\n        });\n      }\n    }\n    onCancel() {\n      this.parentFun.emit('true');\n      this.formCenterBudget.reset();\n    }\n    writeValue(value) {\n      if (value) {\n        this.value = value;\n      }\n      if (value === null) {\n        this.formCenterBudget.reset();\n      }\n    }\n    registerOnChange(fn) {\n      this.onChange = fn;\n    }\n    registerOnTouched(fn) {\n      this.onTouched = fn;\n    }\n    ngOnDestroy() {\n      this.subscriptions.forEach(s => s.unsubscribe());\n    }\n    static #_ = this.ɵfac = function AddEditCenterBudgetComponent_Factory(t) {\n      return new (t || AddEditCenterBudgetComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.InventoryService), i0.ɵɵdirectiveInject(i3.MessageService), i0.ɵɵdirectiveInject(i4.DatePipe), i0.ɵɵdirectiveInject(i5.AuthService), i0.ɵɵdirectiveInject(i6.BuildingService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddEditCenterBudgetComponent,\n      selectors: [[\"app-add-edit-center-budget\"]],\n      inputs: {\n        centerBudgetData: \"centerBudgetData\"\n      },\n      outputs: {\n        parentFun: \"parentFun\"\n      },\n      decls: 34,\n      vars: 22,\n      consts: [[1, \"card\", \"flex\", \"justify-content-center\"], [\"header\", \"\", 3, \"visible\", \"modal\", \"maximizable\", \"breakpoints\", \"visibleChange\", \"onHide\"], [1, \"container-fluid\"], [3, \"formGroup\"], [1, \"row\"], [1, \"col-sm-12\", \"col-md-6\", \"col-xl-6\"], [1, \"input-label-custom\"], [1, \"form-field-lable\", \"control-label\"], [\"appendTo\", \"body\", \"formControlName\", \"budgetTermId\", \"bindLabel\", \"name\", \"bindValue\", \"budgetTermId\", \"placeholder\", \"Make a selection\", 1, \"ng-select-dropdown\", 3, \"clearable\", \"items\", \"searchable\"], [\"appendTo\", \"body\", \"formControlName\", \"blId\", \"bindLabel\", \"blNameString\", \"bindValue\", \"blId\", \"placeholder\", \"Make a selection\", 1, \"ng-select-dropdown\", 3, \"clearable\", \"items\", \"searchable\", \"change\", \"open\", \"scrollToEnd\", \"search\"], [\"appendTo\", \"body\", \"formControlName\", \"flId\", \"bindLabel\", \"flNameString\", \"bindValue\", \"flId\", \"placeholder\", \"Make a selection\", 1, \"ng-select-dropdown\", 3, \"clearable\", \"items\", \"searchable\", \"open\", \"change\", \"scrollToEnd\", \"search\"], [\"appendTo\", \"body\", \"formControlName\", \"itemId\", \"bindLabel\", \"name\", \"bindValue\", \"itemId\", \"placeholder\", \"Make a selection\", 1, \"ng-select-dropdown\", 3, \"clearable\", \"items\", \"searchable\"], [\"type\", \"number\", \"name\", \"budget\", \"formControlName\", \"budget\", \"NumbersOnly\", \"\", 1, \"form-control\"], [\"pTemplate\", \"footer\"], [\"key\", \"save\", \"position\", \"top-right\"], [\"pButton\", \"\", \"label\", \"Save\", \"icon\", \"pi pi-check\", 3, \"disabled\", \"click\"], [\"label\", \"Cancel\", \"icon\", \"pi pi-times\", \"styleClass\", \"p-button-secondary\", 3, \"click\"]],\n      template: function AddEditCenterBudgetComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"p-dialog\", 1);\n          i0.ɵɵlistener(\"visibleChange\", function AddEditCenterBudgetComponent_Template_p_dialog_visibleChange_1_listener($event) {\n            return ctx.showDialogue = $event;\n          })(\"onHide\", function AddEditCenterBudgetComponent_Template_p_dialog_onHide_1_listener() {\n            return ctx.onCancel();\n          });\n          i0.ɵɵelementStart(2, \"p-header\");\n          i0.ɵɵtext(3);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"div\", 2)(5, \"form\", 3)(6, \"div\", 4)(7, \"div\", 5)(8, \"div\", 6)(9, \"label\", 7);\n          i0.ɵɵtext(10, \"Budget Term Id\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(11, \"ng-select\", 8);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(12, \"div\", 5)(13, \"div\", 6)(14, \"label\", 7);\n          i0.ɵɵtext(15, \"Building Id\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"ng-select\", 9);\n          i0.ɵɵlistener(\"change\", function AddEditCenterBudgetComponent_Template_ng_select_change_16_listener($event) {\n            return ctx.onSelectBlCode($event);\n          })(\"open\", function AddEditCenterBudgetComponent_Template_ng_select_open_16_listener() {\n            return ctx.onOpenBl();\n          })(\"scrollToEnd\", function AddEditCenterBudgetComponent_Template_ng_select_scrollToEnd_16_listener() {\n            return ctx.scrollToEndBl();\n          })(\"search\", function AddEditCenterBudgetComponent_Template_ng_select_search_16_listener($event) {\n            return ctx.searchBl($event);\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(17, \"div\", 5)(18, \"div\", 6)(19, \"label\", 7);\n          i0.ɵɵtext(20, \"Floor Id\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"ng-select\", 10);\n          i0.ɵɵlistener(\"open\", function AddEditCenterBudgetComponent_Template_ng_select_open_21_listener() {\n            return ctx.onOpenFl();\n          })(\"change\", function AddEditCenterBudgetComponent_Template_ng_select_change_21_listener($event) {\n            return ctx.onSelectFlCode($event);\n          })(\"scrollToEnd\", function AddEditCenterBudgetComponent_Template_ng_select_scrollToEnd_21_listener() {\n            return ctx.scrollToEndFl();\n          })(\"search\", function AddEditCenterBudgetComponent_Template_ng_select_search_21_listener($event) {\n            return ctx.searchFl($event);\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(22, \"div\", 5)(23, \"div\", 6)(24, \"label\", 7);\n          i0.ɵɵtext(25, \"Item Id\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(26, \"ng-select\", 11);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(27, \"div\", 5)(28, \"div\", 6)(29, \"label\", 7);\n          i0.ɵɵtext(30, \"Budget\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(31, \"input\", 12);\n          i0.ɵɵelementEnd()()()()();\n          i0.ɵɵtemplate(32, AddEditCenterBudgetComponent_ng_template_32_Template, 2, 4, \"ng-template\", 13);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(33, \"p-toast\", 14);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(1);\n          i0.ɵɵstyleMap(i0.ɵɵpureFunction0(20, _c1));\n          i0.ɵɵproperty(\"visible\", ctx.showDialogue)(\"modal\", true)(\"maximizable\", true)(\"breakpoints\", i0.ɵɵpureFunction0(21, _c2));\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", ctx.title, \" Center Budget \");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"formGroup\", ctx.formCenterBudget);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"clearable\", false)(\"items\", ctx.budgetTermList)(\"searchable\", true);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"clearable\", false)(\"items\", ctx.blIdList)(\"searchable\", true);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"clearable\", false)(\"items\", ctx.flIdList)(\"searchable\", true);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"clearable\", false)(\"items\", ctx.itemList)(\"searchable\", true);\n        }\n      },\n      dependencies: [i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i3.Header, i3.PrimeTemplate, i7.ButtonDirective, i7.Button, i8.Dialog, i9.Toast, i10.NumbersOnlyDirective, i11.NgSelectComponent],\n      styles: [\".form-field-lable[_ngcontent-%COMP%]{font-size:11px;margin-bottom:0;font-weight:500}.form-control[_ngcontent-%COMP%]{margin-top:-3px;padding-left:5px}[_ngcontent-%COMP%]::placeholder{color:#555;opacity:1}[_ngcontent-%COMP%]:-ms-input-placeholder{color:#555}[_ngcontent-%COMP%]::-ms-input-placeholder{color:#555}input[type=number][_ngcontent-%COMP%]{background-color:#fff!important;border-color:#879cc9!important;height:24px!important}[_nghost-%COMP%]     .p-dialog .p-dialog-header{background-color:#879cc9;color:#000;padding-left:10px;font-weight:400;margin-bottom:0;height:10px!important}label[_ngcontent-%COMP%]{font-size:10px;font-weight:500;padding:0 0 0 3px;margin-bottom:-10px!important}\"]\n    });\n  }\n  return AddEditCenterBudgetComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}