{"ast":null,"code":"import { AddEditPlanComponent } from '../ppm-plan/widgets/add-edit-plan/add-edit-plan.component';\nimport { AddEditPlanStepsComponent } from '../ppm-plan/widgets/add-edit-plan-steps/add-edit-plan-steps/add-edit-plan-steps.component';\nimport { DocumentsListComponent } from '../documents-list/modal/documents-list.component';\nimport { MessageService } from 'primeng/api';\nimport { PlanTradeComponent } from '../plan-trade/modal/plan-trade.component';\nimport { PlanPartComponent } from '../plan-part/modal/plan-part.component';\nimport { PlanToolComponent } from '../plan-tool/modal/plan-tool.component';\nimport { BreakpointService } from 'src/app/services/breakpoint.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-spinner\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../ppm-plan/services/ppm-plan-services\";\nimport * as i4 from \"primeng/api\";\nimport * as i5 from \"src/app/services/auth.service\";\nimport * as i6 from \"src/app/services/breakpoint.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"primeng/button\";\nimport * as i9 from \"primeng/toast\";\nimport * as i10 from \"primeng/panel\";\nimport * as i11 from \"primeng/tabview\";\nimport * as i12 from \"../ppm-plan/widgets/add-edit-plan/add-edit-plan.component\";\nimport * as i13 from \"../ppm-plan/widgets/add-edit-plan-steps/add-edit-plan-steps/add-edit-plan-steps.component\";\nimport * as i14 from \"../documents-list/modal/documents-list.component\";\nimport * as i15 from \"../plan-trade/modal/plan-trade.component\";\nimport * as i16 from \"../plan-tool/modal/plan-tool.component\";\nimport * as i17 from \"../plan-part/modal/plan-part.component\";\nconst _c0 = function () {\n  return {\n    \"margin-left\": \".5em\"\n  };\n};\nfunction PlanDetailsComponent_div_1_ng_template_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"p-button\", 22);\n    i0.ɵɵlistener(\"click\", function PlanDetailsComponent_div_1_ng_template_12_Template_p_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.clickBack());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵstyleMap(i0.ɵɵpureFunction0(3, _c0));\n    i0.ɵɵproperty(\"hidden\", ctx_r2.hideBackButton);\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    \"readonly-panel\": a0\n  };\n};\nfunction PlanDetailsComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"div\", 5)(2, \"p-panel\", 6)(3, \"p-tabView\", 7);\n    i0.ɵɵlistener(\"onChange\", function PlanDetailsComponent_div_1_Template_p_tabView_onChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.handleChange($event));\n    });\n    i0.ɵɵelementStart(4, \"p-tabPanel\", 8)(5, \"app-add-edit-plan\", 9);\n    i0.ɵɵlistener(\"parentFun\", function PlanDetailsComponent_div_1_Template_app_add_edit_plan_parentFun_5_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.setPlanId($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"p-tabPanel\", 10)(7, \"app-add-edit-plan-steps\", 11);\n    i0.ɵɵlistener(\"parentFun\", function PlanDetailsComponent_div_1_Template_app_add_edit_plan_steps_parentFun_7_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.setPlanStepId($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"p-tabPanel\", 12)(9, \"app-documents-list\", 11);\n    i0.ɵɵlistener(\"parentFun\", function PlanDetailsComponent_div_1_Template_app_documents_list_parentFun_9_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.setDocBucketId($event));\n    });\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(10, \"div\", 5)(11, \"p-panel\", 13);\n    i0.ɵɵtemplate(12, PlanDetailsComponent_div_1_ng_template_12_Template, 1, 4, \"ng-template\", 14);\n    i0.ɵɵelementStart(13, \"p-tabView\", 15);\n    i0.ɵɵlistener(\"onChange\", function PlanDetailsComponent_div_1_Template_p_tabView_onChange_13_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.handleChange($event));\n    });\n    i0.ɵɵelementStart(14, \"p-tabPanel\", 16, 17);\n    i0.ɵɵelement(16, \"app-plan-trade\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"p-tabPanel\", 18, 19);\n    i0.ɵɵelement(19, \"app-plan-tool\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"p-tabPanel\", 20, 21);\n    i0.ɵɵelement(22, \"app-plan-part\");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"data\", ctx_r0.planData);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", !ctx_r0.planData.planId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.planStepId == 0);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(7, _c1, ctx_r0.planStepId > 0 ? false : true));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.planStepId == 0);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.planStepId == 0);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.planStepId == 0);\n  }\n}\nfunction PlanDetailsComponent_div_2_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"p-button\", 22);\n    i0.ɵɵlistener(\"click\", function PlanDetailsComponent_div_2_ng_template_3_Template_p_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r18.clickBack());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r14 = i0.ɵɵnextContext(2);\n    i0.ɵɵstyleMap(i0.ɵɵpureFunction0(3, _c0));\n    i0.ɵɵproperty(\"hidden\", ctx_r14.hideBackButton);\n  }\n}\nfunction PlanDetailsComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 23)(1, \"div\")(2, \"p-panel\", 6);\n    i0.ɵɵtemplate(3, PlanDetailsComponent_div_2_ng_template_3_Template, 1, 4, \"ng-template\", 14);\n    i0.ɵɵelementStart(4, \"p-tabView\", 7);\n    i0.ɵɵlistener(\"onChange\", function PlanDetailsComponent_div_2_Template_p_tabView_onChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.handleChange($event));\n    });\n    i0.ɵɵelementStart(5, \"p-tabPanel\", 8)(6, \"app-add-edit-plan\", 9);\n    i0.ɵɵlistener(\"parentFun\", function PlanDetailsComponent_div_2_Template_app_add_edit_plan_parentFun_6_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.setPlanId($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"p-tabPanel\", 10)(8, \"app-add-edit-plan-steps\", 11);\n    i0.ɵɵlistener(\"parentFun\", function PlanDetailsComponent_div_2_Template_app_add_edit_plan_steps_parentFun_8_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r23 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r23.setPlanStepId($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"p-tabPanel\", 12)(10, \"app-documents-list\", 11);\n    i0.ɵɵlistener(\"parentFun\", function PlanDetailsComponent_div_2_Template_app_documents_list_parentFun_10_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r24 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r24.setDocBucketId($event));\n    });\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(11, \"div\")(12, \"p-panel\", 13)(13, \"p-tabView\", 15);\n    i0.ɵɵlistener(\"onChange\", function PlanDetailsComponent_div_2_Template_p_tabView_onChange_13_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r25 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r25.handleChange($event));\n    });\n    i0.ɵɵelementStart(14, \"p-tabPanel\", 16, 17);\n    i0.ɵɵelement(16, \"app-plan-trade\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"p-tabPanel\", 18, 19);\n    i0.ɵɵelement(19, \"app-plan-tool\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"p-tabPanel\", 20, 21);\n    i0.ɵɵelement(22, \"app-plan-part\");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"data\", ctx_r1.planData);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.planData.planId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.planStepId == 0);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(7, _c1, ctx_r1.planStepId > 0 ? false : true));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.planStepId == 0);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.planStepId == 0);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.planStepId == 0);\n  }\n}\nexport let PlanDetailsComponent = /*#__PURE__*/(() => {\n  class PlanDetailsComponent {\n    constructor(spinner, router, route, ppmPlanService, messageService, authSrv, bps) {\n      this.spinner = spinner;\n      this.router = router;\n      this.route = route;\n      this.ppmPlanService = ppmPlanService;\n      this.messageService = messageService;\n      this.authSrv = authSrv;\n      this.bps = bps;\n      //planData: any = { planId: null };\n      this.plnStepData = [];\n      this.planStepId = 0;\n      // index: number = 0;\n      this.selectedTab = 'Plan';\n      this.docBucketId = 0;\n      this.useTabletProtrait = false;\n      this.hideBackButton = false;\n      this.planData = {\n        planId: null\n      };\n      this.route.queryParams.subscribe(params => {\n        if (params.planId != null) {\n          this.planData.planId = params.planId;\n        } else {\n          this.planData.planId = null;\n        }\n      });\n    }\n    ngOnInit() {\n      this.bps.register(this);\n    }\n    ngAfterViewInit() {\n      if (this.planData.planId) {\n        this.loadPlanSteps(this.planData.planId);\n        this.loadPlanDetails(this.planData.planId);\n      }\n    }\n    notify() {\n      this.useTabletProtrait = BreakpointService.useTabletProtrait;\n      this.refreshAllDetails();\n    }\n    refreshAllDetails() {\n      if (this.addEditPlanComponent) {\n        let planDetails = this.addEditPlanComponent.formPPmDetail.controls.planFormPanel.value;\n        let stepDetails = this.addEditPlanStepsComponent.formPPmDetail.controls.planStepFormPanel.value;\n        setTimeout(() => {\n          this.addEditPlanComponent.formPPmDetail.patchValue({\n            planFormPanel: planDetails\n          });\n          this.addEditPlanStepsComponent.formPPmDetail.patchValue({\n            planFormPanel: stepDetails\n          });\n          this.documentsListComponent.data = {\n            tableName: 'plan_step',\n            fieldName: 'doc_bucket_id',\n            pkField: 'plan_step_id',\n            docBucketId: this.docBucketId,\n            pkValue: this.planStepId\n          };\n          this.documentsListComponent.loadDocumentsByDocBucketId(this.docBucketId);\n          this.planTradeComponent.loadRecords(this.planStepId);\n          this.planToolComponent.loadRecords(this.planStepId);\n          this.planPartComponent.loadRecords(this.planStepId);\n        }, 100);\n      }\n    }\n    loadPlanDetails(planId) {\n      this.addEditPlanComponent.loadData(planId);\n    }\n    loadPlanSteps(planId) {\n      this.plnStepData = [];\n      this.planStepId = 0;\n      this.ppmPlanService.getAllPlanSteps(planId).subscribe(res => {\n        if (res.length) {\n          this.plnStepData = res;\n          this.planStepId = this.plnStepData[0].planStepId;\n          this.docBucketId = this.plnStepData[0].docBucketId;\n          this.planTradeComponent.loadRecords(this.planStepId);\n          // this.planToolComponent.loadRecords( this.planStepId);\n          // this.planPartComponent.loadRecords( this.planStepId);\n        } else {\n          this.plnStepData = [];\n          this.planStepId = 0;\n        }\n      });\n    }\n    handleChange(event) {\n      if (event != null) {\n        // this.index = event.index;\n        this.selectedTab = event.originalEvent.target.innerText;\n      }\n      switch (this.selectedTab) {\n        case \"Plan\":\n          this.addEditPlanComponent.loadData(this.planData.planId);\n          break;\n        case \"Step\":\n          this.addEditPlanStepsComponent.loadData(this.planData.planId, this.planStepId);\n          break;\n        case \"Documents\":\n          this.documentsListComponent.data = {\n            tableName: 'plan_step',\n            fieldName: 'doc_bucket_id',\n            pkField: 'plan_step_id',\n            docBucketId: this.docBucketId,\n            pkValue: this.planStepId\n          };\n          this.documentsListComponent.loadDocumentsByDocBucketId(this.docBucketId);\n          break;\n        case \"Trades\":\n          this.planTradeComponent.loadRecords(this.planStepId);\n          break;\n        case \"Tools\":\n          this.planToolComponent.loadRecords(this.planStepId);\n          break;\n        case \"Parts\":\n          this.planPartComponent.loadRecords(this.planStepId);\n          break;\n      }\n    }\n    setDocBucketId(docBucketId) {\n      this.docBucketId = docBucketId;\n    }\n    setPlanId(planId) {\n      this.messageService.clear();\n      this.planData.planId = planId;\n      this.addEditPlanComponent.loadData(this.planData.planId);\n      this.messageService.add({\n        key: 'planDetails',\n        severity: 'success',\n        summary: 'Record saved successfully',\n        detail: 'Record saved successfully'\n      });\n    }\n    setPlanStepId(planStep) {\n      this.messageService.clear();\n      this.planStepId = planStep.planStepId;\n      this.docBucketId = planStep.docBucketId;\n      this.addEditPlanStepsComponent.loadData(this.planData.planId, this.planStepId);\n      this.planTradeComponent.loadRecords(this.planStepId);\n      this.messageService.add({\n        key: 'planDetails',\n        severity: 'success',\n        summary: 'Record saved successfully',\n        detail: 'Record saved successfully'\n      });\n    }\n    clickBack() {\n      this.router.navigate(['/define-plan']);\n    }\n    ngOnDestroy() {\n      this.bps.unregister(this);\n    }\n    static #_ = this.ɵfac = function PlanDetailsComponent_Factory(t) {\n      return new (t || PlanDetailsComponent)(i0.ɵɵdirectiveInject(i1.NgxSpinnerService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.PpmPlanService), i0.ɵɵdirectiveInject(i4.MessageService), i0.ɵɵdirectiveInject(i5.AuthService), i0.ɵɵdirectiveInject(i6.BreakpointService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: PlanDetailsComponent,\n      selectors: [[\"app-plan-details\"]],\n      viewQuery: function PlanDetailsComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(AddEditPlanComponent, 5);\n          i0.ɵɵviewQuery(AddEditPlanStepsComponent, 5);\n          i0.ɵɵviewQuery(DocumentsListComponent, 5);\n          i0.ɵɵviewQuery(PlanTradeComponent, 5);\n          i0.ɵɵviewQuery(PlanToolComponent, 5);\n          i0.ɵɵviewQuery(PlanPartComponent, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.addEditPlanComponent = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.addEditPlanStepsComponent = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.documentsListComponent = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.planTradeComponent = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.planToolComponent = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.planPartComponent = _t.first);\n        }\n      },\n      inputs: {\n        hideBackButton: \"hideBackButton\",\n        planData: \"planData\"\n      },\n      features: [i0.ɵɵProvidersFeature([MessageService])],\n      decls: 4,\n      vars: 2,\n      consts: [[2, \"height\", \"90vh\"], [\"style\", \"display: flex;\", 4, \"ngIf\"], [\"style\", \"display: flex; flex-direction: column;\", 4, \"ngIf\"], [\"key\", \"planDetails\", \"position\", \"top-right\"], [2, \"display\", \"flex\"], [1, \"col\", \"col-sm-6\", \"col-md-6\", \"col-lg-6\"], [\"header\", \"Plan Details\", \"id\", \"panelDetail\"], [3, \"onChange\"], [\"header\", \"Plan\"], [3, \"data\", \"parentFun\"], [\"header\", \"Step\", 3, \"disabled\"], [3, \"parentFun\"], [\"header\", \"Documents\", 3, \"disabled\"], [\"id\", \"back\"], [\"pTemplate\", \"icons\"], [3, \"ngClass\", \"onChange\"], [\"header\", \"Trades\", 3, \"disabled\"], [\"trades\", \"\"], [\"header\", \"Tools\", 3, \"disabled\"], [\"tools\", \"\"], [\"header\", \"Parts\", 3, \"disabled\"], [\"parts\", \"\"], [\"label\", \"Back\", \"icon\", \"pi pi-arrow-circle-left\", \"styleClass\", \"p-button-secondary\", 3, \"hidden\", \"click\"], [2, \"display\", \"flex\", \"flex-direction\", \"column\"]],\n      template: function PlanDetailsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0);\n          i0.ɵɵtemplate(1, PlanDetailsComponent_div_1_Template, 23, 9, \"div\", 1);\n          i0.ɵɵtemplate(2, PlanDetailsComponent_div_2_Template, 23, 9, \"div\", 2);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(3, \"p-toast\", 3);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.useTabletProtrait);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.useTabletProtrait);\n        }\n      },\n      dependencies: [i7.NgClass, i7.NgIf, i4.PrimeTemplate, i8.Button, i9.Toast, i10.Panel, i11.TabView, i11.TabPanel, i12.AddEditPlanComponent, i13.AddEditPlanStepsComponent, i14.DocumentsListComponent, i15.PlanTradeComponent, i16.PlanToolComponent, i17.PlanPartComponent],\n      styles: [\"[_nghost-%COMP%]     .p-tabview .p-tabview-nav li .p-tabview-nav-link{border-color:#879cc9;background:#879cc9;color:#fff;margin-right:2px;line-height:2.35;min-width:80px;border-radius:6px 6px 0 0;border-bottom:3px solid #879cc9!important;box-shadow:none!important}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li.p-highlight .p-tabview-nav-link{background:#ffffff;border-color:#879cc9;color:#000;margin-right:2px;line-height:2.35;min-width:80px;border-radius:6px 6px 0 0;border-bottom:3px solid #879cc9!important;box-shadow:none!important}[_nghost-%COMP%]     #back .p-panel .p-panel-header{padding:4px!important}.readonly-panel[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}\"]\n    });\n  }\n  return PlanDetailsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}