<div class="card" style="height: 90vh;">
    <p-panel header="Employee Summary" [toggleable]="true">
        <form [formGroup]="filterPanel">
            <table width="100%" *ngIf="!useTabletProtrait">
                <tr>
                    <td style="width:20%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable '>Building </label>
                            <ng-select appendTo="body" [clearable]="false" [items]="enumBL" formControlName="blId"
                                [searchable]="true" bindLabel="blNameString" bindValue="blId" (change)="onSelectBlCode($event)"(open)="onOpenBl()"
                                placeholder="Make a selection" class="ng-select-dropdown" (scrollToEnd)="scrollToEndBl()" (search)="searchBl($event)">
                            </ng-select>
                        </div>
                    </td>
                    <td style="width:20%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable '>Floor</label>
                            <ng-select appendTo="body" [clearable]="false" [items]="enumFL" formControlName="flId"
                                [searchable]="true" bindLabel="flNameString" bindValue="flId" placeholder="Make a selection"(open)="onOpenFl()"
                                class="ng-select-dropdown" (change)="onSelectFlCode($event)"  (scrollToEnd)="scrollToEndFl()" (search)="searchFl($event)">
                            </ng-select>
                        </div>
                    </td>
                    <td width="20%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable control-label'>View By</label>
                            <ng-select appendTo="body" [clearable]="false" [searchable]="true"
                                placeholder="Make a selection" class="ng-select-dropdown" [items]="viewByData"
                                formControlName="viewBy" bindLabel="lable" bindValue="value"
                                (change)="changeViewBy($event)">
                            </ng-select>
                        </div>
                    </td>
                    <td width="20%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable control-label'>Display Type</label>
                            <ng-select appendTo="body" [clearable]="false" [searchable]="false"
                                placeholder="Make a selection" class="ng-select-dropdown" [items]="displayTypeData"
                                formControlName="displayType" bindLabel="lable" bindValue="value"
                                (change)="onSelectDisplayType($event)">
                            </ng-select>
                        </div>
                    </td>
                    <td style="width:20%">
                    <button (click)="onClickFilter()" pButton pRipple label="Search" [disabled]="!filterPanel.valid"
                        style="width: 60px; margin-top:15px;"
                        class="p-button-primary"></button>
                    <button (click)="onClear()" pButton pRipple label="Clear"
                        style="width: 60px;  margin-left: 5px; margin-top:15px;"
                        class="p-button-primary p-button-sm pull right"></button>
                        <div *ngIf="isGridType" style="width:30px; display:inline-flex">
                            <button type="button" (click)="exportExcel()" pButton pRipple  icon="pi pi-file-excel"
                        class="p-button-success p-mr-2 pull-right" matTooltip="XLS" style="margin-left: 5px;" matTooltipPosition="below"></button>
                        </div>
                        <div *ngIf="!isGridType" style="width:30px; display:inline-flex">
                            <p-button icon="pi pi-file-pdf" (click)="exportChartToPDF()" matTooltip="Generate PDF" matTooltipPosition="below"
                            style="width: 30px; margin-left: 5px;" styleClass="p-button-raised p-button-danger"></p-button>
                        </div>
                    </td>
                </tr>
            </table>
            <table width="100%" *ngIf="useTabletProtrait">
                <tr>
                    <td style="width:25%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable '>Building </label>
                            <ng-select appendTo="body" [clearable]="false" [items]="enumBL" formControlName="blId"
                                [searchable]="true" bindLabel="blNameString" bindValue="blId" (change)="onSelectBlCode($event)"(open)="onOpenBl()"
                                placeholder="Make a selection" class="ng-select-dropdown" (scrollToEnd)="scrollToEndBl()" (search)="searchBl($event)">
                            </ng-select>
                        </div>
                    </td>
                    <td style="width:25%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable '>Floor</label>
                            <ng-select appendTo="body" [clearable]="false" [items]="enumFL" formControlName="flId"
                                [searchable]="true" bindLabel="flNameString" bindValue="flId" placeholder="Make a selection"(open)="onOpenFl()"
                                class="ng-select-dropdown" (change)="onSelectFlCode($event)" (scrollToEnd)="scrollToEndFl()" (search)="searchFl($event)">
                            </ng-select>
                        </div>
                    </td>
                    <td width="25%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable control-label'>View By</label>
                            <ng-select appendTo="body" [clearable]="false" [searchable]="true"
                                placeholder="Make a selection" class="ng-select-dropdown" [items]="viewByData"
                                formControlName="viewBy" bindLabel="lable" bindValue="value"
                                (change)="changeViewBy($event)">
                            </ng-select>
                        </div>
                    </td>
                    <td width="25%">
                        <div class="input-label-custom ">
                            <label class='form-field-lable control-label'>Display Type</label>
                            <ng-select appendTo="body" [clearable]="false" [searchable]="false"
                                placeholder="Make a selection" class="ng-select-dropdown" [items]="displayTypeData"
                                formControlName="displayType" bindLabel="lable" bindValue="value"
                                (change)="onSelectDisplayType($event)">
                            </ng-select>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td style="width:25%">
                        <button (click)="onClickFilter()" pButton pRipple label="Search" [disabled]="!filterPanel.valid"
                            style="margin-top:15px;" class="p-button-primary"></button>
                        <button (click)="onClear()" pButton pRipple label="Clear"
                            style="margin-left: 5px; margin-top:15px;" class="p-button-primary "></button>
                            <div *ngIf="isGridType" style="width:30px; display:inline-flex">
                                <button type="button" (click)="exportExcel()" pButton pRipple  icon="pi pi-file-excel"
                            class="p-button-success p-mr-2 pull-right"matTooltip="XLS" style="margin-left: 5px;" matTooltipPosition="below"></button>
                            </div>
                            <div *ngIf="!isGridType" style="width:30px; display:inline-flex">
                                <p-button icon="pi pi-file-pdf" (click)="exportChartToPDF()" matTooltip="Generate PDF" matTooltipPosition="below"
                                style="width: 30px; margin-left: 5px;" styleClass="p-button-raised p-button-danger"></p-button>
                            </div>
                    </td>
                </tr>
            </table>
        </form>
    </p-panel>

    <div class="card" *ngIf="isGridType">
        <p-table [value]="gridReportData" [paginator]="false" [rows]="rowCount"
            styleClass="p-datatable-responsive-demo p-datatable-gridlines" [rowHover]="false"
            (onFilter)="onInnerFilter($event)">
            <ng-template pTemplate="header">
                <tr>
                    <th *ngIf="showThirdParam" pSortableColumn="thirdParamValue">
                        <div class="grid-header-column">
                            <div class="grid-header-label">
                                <p class="grid-label-paragraph"> {{thirdParamName}}</p>
                            </div>
                            <div class="grid-sort-icon">
                                <p-sortIcon field="thirdParamValue"></p-sortIcon>
                                <p-columnFilter type="text" field="thirdParamValue" display="menu"></p-columnFilter>
                            </div>
                        </div>
                    </th>
                    <th *ngIf="showSecondParam" pSortableColumn="secondParamValue">
                        <div class="grid-header-column">
                            <div class="grid-header-label">
                                <p class="grid-label-paragraph"> {{secondParamName}}</p>
                            </div>
                            <div class="grid-sort-icon">
                                <p-sortIcon field="secondParamValue"></p-sortIcon>
                                <p-columnFilter type="text" field="secondParamValue" display="menu"></p-columnFilter>
                            </div>
                        </div>
                    </th>
                    <th pSortableColumn="firstParamValue">
                        <div class="grid-header-column">
                            <div class="grid-header-label">
                                <p class="grid-label-paragraph"> {{displayGridLabel}}</p>
                            </div>
                            <div class="grid-sort-icon">
                                <p-sortIcon field="firstParamValue"></p-sortIcon>
                                <p-columnFilter type="text" field="firstParamValue" display="menu"></p-columnFilter>
                            </div>
                        </div>
                    </th>
                    <th pSortableColumn="value">
                        <div class="grid-header-column">
                            <div class="grid-header-label">
                                <p class="grid-label-paragraph">Number of Employees</p>
                            </div>
                            <div class="grid-sort-icon">
                                <p-sortIcon field="value"></p-sortIcon>
                            </div>
                        </div>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-report>
                <tr (click)="onClickCount(report)" style="cursor: pointer;">
                    <ng-container *ngIf="showSecondParam && !showThirdParam">
                        <td style="width: calc(100% / 3);">{{ report.secondParamValue }}</td>
                        <td style="width: calc(100% / 3);">{{ report.firstParamValue }}</td>
                        <td style="width: calc(100% / 3);">{{ report.value }}</td>
                      </ng-container>
                      <ng-container *ngIf="showThirdParam && showSecondParam">
                        <td style="width: calc(100% / 4);">{{ report.thirdParamValue }}</td>
                        <td style="width: calc(100% / 4);">{{ report.secondParamValue }}</td>
                        <td style="width: calc(100% / 4);">{{ report.firstParamValue }}</td>
                        <td style="width: calc(100% / 4);">{{ report.value }}</td>
                      </ng-container>
                      <ng-container *ngIf="!showSecondParam && !showThirdParam">
                        <td style="width: 50%;">{{ report.firstParamValue }}</td>
                        <td style="width: 50%;">{{ report.value }}</td>
                      </ng-container>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
                <tr>
                    <td [attr.colspan]="3">
                        No records found
                    </td>
                </tr>
            </ng-template>
        </p-table>
        <div class="paginator">
            <p-paginator [rows]="rowCount" [totalRecords]="totalElements" (onPageChange)="onPageChange($event)"
                [first]="paginationObj.pageNo * paginationObj.pageSize"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [showCurrentPageReport]="true"
                [rowsPerPageOptions]="[25,50,100]"></p-paginator>
          </div>
    </div>

    <div *ngIf="!isGridType" #chartContainer style="overflow-x: auto;">
        <div style="display: flex;">   
            <ngx-charts-bar-vertical [view]="view" [scheme]="customColor" [results]="barchartData"  [showXAxisLabel]="showXAxisLabel"
            [xAxisLabel]="xAxisLabel" [xAxis]="showXAxis" 
            [showGridLines]="showGridLines"
            [yAxis]="showYAxis"
            [legend]="showLegend"
            [yAxisTickFormatting]="formatYAxisTickLabel"
            [showYAxisLabel]="showYAxisLabel"
            [yAxisLabel]="yAxisLabel" (select)="onSelectBarChart($event)">
            </ngx-charts-bar-vertical>
            <div class="legend">
                <div class="legend-title-container">
                    <p class="legend-title">Legend</p>
                </div>
                <div >
                    <ul class="legend-labels" *ngFor="let item of legendItems; let i = index;">
                        <li class="legend-label" (click)="onLegendItemClick(item)">
                            <span title="{{item.name}}">
                                <span class="legend-label-color"[style.background-color]="customColor.domain[i]"></span>
                                <span class="legend-label-text">{{item.name}}</span>
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div> 
    </div>

    <p-dialog [(visible)]="showPopUpGrid" [modal]="true" [style]="{width: '66vw'}" [maximizable]="true"
        [draggable]="false" [resizable]="false" styleClass="dark-panel" id="preview">
        <ng-template pTemplate="header">
            <h2 style="margin: 0px;">Employee List</h2>
        </ng-template>
        <ng-template pTemplate="body">
            <app-add-emp-report-table [data] ="employeeData"></app-add-emp-report-table>
        </ng-template>
    </p-dialog>
</div>
<p-toast key="reportEmployee" position="top-center"></p-toast>