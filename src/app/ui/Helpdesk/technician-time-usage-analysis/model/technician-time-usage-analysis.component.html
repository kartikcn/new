<p-panel header="Technician Time Usage" [toggleable]="true">
  <form [formGroup]="filterPanel">
    <table width="100%" *ngIf="!useTabletProtrait">
      <tr>
        <td style="width: 20%">
          <div class="input-label-custom ">
            <label class='form-field-lable control-label'>Technician</label>
            <ng-select appendTo="body" [clearable]="false" [items]="technicianData" formControlName="technicianId"
              [searchable]="true" bindLabel="name" bindValue="cfId" class="ng-select-dropdown"
              placeholder="Make a Selection">
            </ng-select>
          </div>
        </td>
        <td style="width:20%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable'>Scheduled From</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="dateFrom" formControlName="dateFrom"
                  [showIcon]="false" inputId="icon"></p-calendar>
              </div>
            </div>
          </div>
        </td>
        <td style="width:20%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable'>Scheduled To</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="dateTo" formControlName="dateTo"
                  [showIcon]="false" inputId="icon"></p-calendar>
              </div>
            </div>
          </div>
        </td>
        <td style="width:20%">
          <div class="input-label-custom ">
              <label class='form-field-lable'>Requests Type </label>
              <ng-select appendTo="body" [clearable]="false" [searchable]="true"
                  placeholder="Make a selection" class="ng-select-dropdown" [items]="showRequestsTypeList"
                  formControlName="showType"  [searchable]="true"
                  bindLabel="label" bindValue="value">
              </ng-select>
          </div>
      </td>
        <td style="width:20%;">
          <div style="display: flex; flex-direction: row;justify-content: center; margin-top:12.5px;">
            <button pButton pRipple label="Search" (click)="onSearch()" 
              class="p-button-primary p-button-sm filter-search-button" [disabled]="!filterPanel.valid"></button>
            <button pButton (click)="onClear()" pRipple label="Clear" 
              class="p-button-primary p-button-sm pull-right filter-clear-button"></button>
          </div>
        </td>
      </tr>
    </table>
    <table width="100%" *ngIf="useTabletProtrait">
      <tr>
        <td style="width: 30%">
          <div class="input-label-custom ">
            <label class='form-field-lable control-label'>Technician</label>
            <ng-select appendTo="body" [clearable]="false" [items]="technicianData" formControlName="technicianId"
              [searchable]="true" bindLabel="name" bindValue="cfId" class="ng-select-dropdown"
              placeholder="Make a Selection">
            </ng-select>
          </div>
        </td>
        <td style="width:30%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable'>Scheduled From</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="dateFrom" formControlName="dateFrom"
                  [showIcon]="false" inputId="icon"></p-calendar>
              </div>
            </div>
          </div>
        </td>
        <td style="width:30%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable'>Scheduled To</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="dateTo" formControlName="dateTo"
                  [showIcon]="false" inputId="icon"></p-calendar>
              </div>
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td style="width:30%">
          <div class="input-label-custom ">
              <label class='form-field-lable'>Requests Type </label>
              <ng-select appendTo="body" [clearable]="false" [searchable]="true"
                  placeholder="Make a selection" class="ng-select-dropdown" [items]="showRequestsTypeList"
                  formControlName="showType"  [searchable]="true"
                  bindLabel="label" bindValue="value">
              </ng-select>
          </div>
        </td>
        <td style="width:30%;">
          <div style="display: flex; flex-direction: row;justify-content: center; margin-top:12.5px;">
            <button pButton pRipple label="Search" (click)="onSearch()" 
              class="p-button-primary p-button-sm filter-search-button" [disabled]="!filterPanel.valid"></button>
            <button pButton (click)="onClear()" pRipple label="Clear" 
              class="p-button-primary p-button-sm pull-right filter-clear-button"></button>
          </div>
        </td>
      </tr>
    </table>
  </form>
</p-panel>
<p-panel>
  <ng-template pTemplate="header">
      <div class="xls-container">
        <button type="button" (click)="exportExcel()" pButton pRipple icon="pi pi-file-excel"
          class="p-button-success p-mr-2 pull-right" style="margin-left: auto;" matTooltip="XLS" matTooltipPosition="below"
          [disabled]="!(technicanTimeUsageanalysisData.length > 0)"></button>
      </div>
  </ng-template>
  <div class="card">
    <p-table [rows]="rowCount" [value]="technicanTimeUsageanalysisData"
      styleClass="p-datatable-customers p-datatable-gridlines" [paginator]="false" 
      [loading]="loading">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="formatedScheduledDate">
            <div class="grid-header-column">
              <div class="grid-header-label">
                <p class="grid-label-paragraph">Scheduled Date</p>
              </div>
              <div class="grid-sort-icon">
                <p-sortIcon field="formatedScheduledDate"></p-sortIcon>
                <p-columnFilter type="text" field="formatedScheduledDate" display="menu"></p-columnFilter>
              </div>
            </div>
          </th>
          <th pSortableColumn="timeAssign">
            <div class="grid-header-column">
              <div class="grid-header-label">
                <p class="grid-label-paragraph">Scheduled Time</p>
              </div>
              <div class="grid-sort-icon">
                <p-sortIcon field="timeAssign"></p-sortIcon>
                <p-columnFilter type="text" field="timeAssign" display="menu"></p-columnFilter>
              </div>
            </div>
          </th>
          <th pSortableColumn="hoursRequired">
            <div class="grid-header-column">
              <div class="grid-header-label">
                <p class="grid-label-paragraph">Estimated Hours</p>
              </div>
              <div class="grid-sort-icon">
                <p-sortIcon field="hoursRequired"></p-sortIcon>
                <p-columnFilter type="text" field="hoursRequired" display="menu"></p-columnFilter>
              </div>
            </div>
          </th>
          <th pSortableColumn="actualHours">
            <div class="grid-header-column">
              <div class="grid-header-label">
                <p class="grid-label-paragraph">Actual Hours</p>
              </div>
              <div class="grid-sort-icon">
                <p-sortIcon field="actualHours"></p-sortIcon>
                <p-columnFilter type="text" field="actualHours" display="menu"></p-columnFilter>
              </div>
            </div>
          </th>
          <th pSortableColumn="requestId">
            <div class="grid-header-column">
              <div class="grid-header-label">
                <p class="grid-label-paragraph">Request Code</p>
              </div>
              <div class="grid-sort-icon">
                <p-sortIcon field="requestId"></p-sortIcon>
                <p-columnFilter type="text" field="requestId" display="menu"></p-columnFilter>
              </div>
            </div>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-techTime>
        <tr>
          <td>{{techTime.dateAssign | date :"dd MMM yyyy"}}</td>
          <td>{{convertToDisplayTime(techTime.timeAssign)}}</td>
          <td>{{techTime.hoursRequired }}</td>
          <td>
            <button pButton pRipple icon="pi pi-info-circle"
              (click)="getWorkingHoursByTechnicianIdAndRequestId(techTime.requestId)" matTooltip="View Detailed Log"
              class="p-button-rounded pull-right" style="height: 16px !important; width: 16px;"></button>
            {{techTime.actualHoursStd + techTime.actualHoursDouble + techTime.actualHoursOvertime}}
          </td>
          <td>{{techTime.requestId}}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="5">
            No records found.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-panel>
<p-dialog header="Work Log Details" [(visible)]="showDetails" [draggable]="false" [modal]="true" *ngIf="showDetails"
  [style]="{width: '50vw'}">

  <p-table [rows]="rowCount" [value]="technicanData" styleClass="p-datatable-customers p-datatable-gridlines"
    [paginator]="false"  [loading]="loading">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="workType">
          Work Type<p-sortIcon field="workType"></p-sortIcon>
          <p-columnFilter field="workType" matchMode="equals" display="menu">
            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
              <p-dropdown [ngModel]="value" [options]="enumWorkType" optionLabel="enumValue" optionValue="enumKey"
                (onChange)="filter($event.value)" placeholder="Select a work type" [showClear]="true"></p-dropdown>
            </ng-template>
          </p-columnFilter>
        </th>
        <th pSortableColumn="actualHoursStd">
          Standard Hours<p-sortIcon field="actualHoursStd"></p-sortIcon>
          <p-columnFilter type="text" field="actualHoursStd" display="menu"></p-columnFilter>
        </th>
        <th pSortableColumn="actualHoursDouble">
          Double Hours<p-sortIcon field="actualHoursDouble"></p-sortIcon>
          <p-columnFilter type="text" field="actualHoursDouble" display="menu"></p-columnFilter>
        </th>
        <th pSortableColumn="actualHoursOvertime">
          Overtime Hours<p-sortIcon field="actualHoursOvertime"></p-sortIcon>
          <p-columnFilter type="text" field="actualHoursOvertime" display="menu"></p-columnFilter>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-techTime>
      <tr>
        <td>{{getEnumById(techTime.workType)}}</td>
        <td>{{techTime.actualHoursStd}}</td>
        <td>{{techTime.actualHoursDouble}}</td>
        <td>{{techTime.actualHoursOvertime}}</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="technicanData.length">
          No Records.
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>