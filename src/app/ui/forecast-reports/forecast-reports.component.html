<div class="card" style=" overflow-x: auto; padding: 5px;">
  <form [formGroup]="filterPanel">
    <table width="100%" *ngIf="!useTabletProtrait">
      <tr>
        <td style="width: 20%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable control-label'>From Date</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="date" formControlName="fromDate"
                  [minDate]="today" [showIcon]="false" inputId="icon"></p-calendar>
              </div>
            </div>
          </div>
        </td>
        <td style="width: 20%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable control-label'>To Date</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="date" formControlName="toDate" [showIcon]="false"
                  inputId="icon" [minDate]="today" [maxDate]="maxDate"></p-calendar>
              </div>
            </div>
          </div>
        </td>
        <td style="width:20%">
          <div class="input-label-custom ">
            <label class='form-field-lable '>Building </label>
            <ng-select appendTo="body" [clearable]="false" [items]="enumBL" formControlName="blId" [searchable]="true"
              bindLabel="blNameString" bindValue="blId" (change)="onSelectBlCode($event)" placeholder="Make a selection"
              class="ng-select-dropdown" (scrollToEnd)="scrollToEndBl()" (search)="searchBl($event)"
              (open)="onOpenBl()">
            </ng-select>
          </div>
        </td>
        <td style="width:20%">
          <div class="input-label-custom ">
            <label class='form-field-lable '>Floor</label>
            <ng-select appendTo="body" [clearable]="false" [items]="enumFL" formControlName="flId" [searchable]="true"
              bindLabel="flNameString" bindValue="flId" placeholder="Make a selection" class="ng-select-dropdown"
              (change)="onSelectFlCode($event)" (scrollToEnd)="scrollToEndFl()" (search)="searchFl($event)"
              (open)="onOpenFl()">
            </ng-select>
          </div>
        </td>
        <td style="width: 20%">
          <div class="input-label-custom ">
            <label class='form-field-lable'>Room </label>
            <ng-select appendTo="body" [clearable]="false" [searchable]="true" placeholder="Make a selection"
              class="ng-select-dropdown" [items]="enumRm" formControlName="rmId" (change)="onSelectRmCode($event)"
              [searchable]="true" bindLabel="rmNameString" bindValue="rmId" (scrollToEnd)="scrollToEndRm()"
              (search)="searchRm($event)" (open)="onOpenRm()">
            </ng-select>
          </div>
        </td>
      </tr>
      <tr *ngIf="dateErrorMsg.length >0 ">
        <td style="width: 20%">
          <div>
            <label class='form-field-lable' style="color:red;">{{dateErrorMsg}}</label>
          </div>
        </td>
      </tr>
      <tr>
        <td style="width: 20%">
          <div class="input-label-custom ">
            <label class='form-field-lable'>Asset</label>
            <ng-select appendTo="body" [items]="enumEquipment" [clearable]="false" [searchable]="true"
              placeholder="Make a selection" bindLabel="eqCode" bindValue="eqId" class="ng-select-dropdown"
              formControlName="eqId" (change)="onSelectAsset($event)">
            </ng-select>
          </div>
        </td>
        <td style="width: 20%">
          <div class="input-label-custom ">
            <label class='form-field-lable'>Plan Name</label>
            <ng-select appendTo="body" [clearable]="false" [items]="planList" formControlName="planId"
              [searchable]="true" bindLabel="planName" bindValue="planId" placeholder="Make a selection"
              class="ng-select-dropdown">
            </ng-select>
          </div>
        </td>
        <td width="20%">
        </td>
        <td style="width: 20%">
        </td>
        <td style="width: 20%">
          <div style="margin-top:16px;margin-right:10px;display: flex;justify-content: flex-end;">
            <button (click)="onSearch()" pButton pRipple label="Search" style="width: 60px;  margin-left: 5px;"
              class="p-button-primary p-button-sm pull right" [disabled]="!filterPanel.valid"></button>
            <button (click)="onClear()" pButton pRipple label="Clear" style="width: 60px;  margin-left: 5px;"
              class="p-button-primary p-button-sm pull right"></button>
          </div>
        </td>
      </tr>
    </table>
    <table width="100%" *ngIf="useTabletProtrait">
      <tr>
        <td style="width: 25%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable control-label'>From Date</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="date" formControlName="fromDate"
                  [minDate]="today" [showIcon]="false" inputId="icon"></p-calendar>
              </div>
            </div>
          </div>
        </td>
        <td style="width: 25%">
          <div class="input-label-custom">
            <div class="p-fluid">
              <div class="p-field">
                <label class='form-field-lable control-label'>To Date</label>
                <p-calendar appendTo="body" dateFormat="dd M yy" name="date" formControlName="toDate" [showIcon]="false"
                  inputId="icon" [minDate]="today" [maxDate]="maxDate"></p-calendar>
              </div>
            </div>
          </div>
        </td>
        <td style="width: 25%">
          <div class="input-label-custom ">
            <label class='form-field-lable'>Plan Name</label>
            <ng-select appendTo="body" [clearable]="false" [items]="planList" formControlName="planId"
              [searchable]="true" bindLabel="planName" bindValue="planId" placeholder="Make a selection"
              class="ng-select-dropdown">
            </ng-select>
          </div>
        </td>
      </tr>
      <tr *ngIf="dateErrorMsg.length >0 ">
        <td style="width: 25%">
          <div>
            <label class='form-field-lable' style="color:red;">{{dateErrorMsg}}</label>
          </div>
        </td>
      </tr>
      <tr>
        <td style="width:25%">
          <div class="input-label-custom ">
            <label class='form-field-lable '>Building </label>
            <ng-select appendTo="body" [clearable]="false" [items]="enumBL" formControlName="blId" [searchable]="true"
              bindLabel="blNameString" bindValue="blId" (change)="onSelectBlCode($event)" placeholder="Make a selection"
              class="ng-select-dropdown" (scrollToEnd)="scrollToEndBl()" (search)="searchBl($event)"
              (open)="onOpenBl()">
            </ng-select>
          </div>
        </td>
        <td style="width:25%">
          <div class="input-label-custom ">
            <label class='form-field-lable '>Floor</label>
            <ng-select appendTo="body" [clearable]="false" [items]="enumFL" formControlName="flId" [searchable]="true"
              bindLabel="flNameString" bindValue="flId" placeholder="Make a selection" class="ng-select-dropdown"
              (change)="onSelectFlCode($event)" (scrollToEnd)="scrollToEndFl()" (search)="searchFl($event)"
              (open)="onOpenFl()">
            </ng-select>
          </div>
        </td>
        <td style="width: 25%">
          <div class="input-label-custom ">
            <label class='form-field-lable'>Room </label>
            <ng-select appendTo="body" [clearable]="false" [searchable]="true" placeholder="Make a selection"
              class="ng-select-dropdown" [items]="enumRm" formControlName="rmId" (change)="onSelectRmCode($event)"
              [searchable]="true" bindLabel="rmNameString" bindValue="rmId" (scrollToEnd)="scrollToEndRm()"
              (open)="onOpenRm()" (search)="searchRm($event)">
            </ng-select>
          </div>
        </td>
      </tr>
      <tr>
        <td style="width: 25%">
          <div class="input-label-custom ">
            <label class='form-field-lable'>Asset</label>
            <ng-select appendTo="body" [items]="enumEquipment" [clearable]="false" [searchable]="true"
              placeholder="Make a selection" bindLabel="eqCode" bindValue="eqId" class="ng-select-dropdown"
              formControlName="eqId" (change)="onSelectAsset($event)">
            </ng-select>
          </div>
        </td>
        <td style="width: 25%"></td>
        <td style="width: 25%">
          <div style="margin-top:16px;margin-right:10px;display: flex;justify-content: flex-end;">
            <button (click)="onSearch()" pButton pRipple label="Search" style="width: 60px;  margin-left: 5px;"
              class="p-button-primary p-button-sm pull right" [disabled]="!filterPanel.valid"></button>
            <button (click)="onClear()" pButton pRipple label="Clear" style="width: 60px;  margin-left: 5px;"
              class="p-button-primary p-button-sm pull right"></button>
          </div>
        </td>
      </tr>
    </table>
  </form>
</div>
<div class="card" *ngIf="showCard" style="height:72vh;" id="contentArea" #contentArea>
  <div style="margin:0px 5px 0px 5px;">
    <div style="height:50px;display: flex;align-items: center;justify-content: space-between;">
      <div style="margin-left:5px;">
        <p-selectButton [options]="showByData" [(ngModel)]="showByValue" [multiple]="false" optionLabel="label"
          optionValue="value" (onChange)="onShowByChange($event)"></p-selectButton>
      </div>
      <div style="margin-right:5px;">
        <div style="display: flex;">
          <div style="margin-right:10px;">
            <p-checkbox name="group1" value="trade" [(ngModel)]="selectedDisplayParameters" inputId="trade"
              class="select-box" (onChange)="checkboxSelected($event)"></p-checkbox>
            <label class="select-label" for="trade">Trade</label>
          </div>
          <div style="margin-right:10px;">
            <p-checkbox name="group1" value="part" [(ngModel)]="selectedDisplayParameters" inputId="part"
              class="select-box" (onChange)="checkboxSelected($event)"></p-checkbox>
            <label class="select-label" for="part">Part</label>
          </div>
          <div style="margin-right:10px;">
            <p-checkbox name="group1" value="tool" [(ngModel)]="selectedDisplayParameters" inputId="tool"
              class="select-box" (onChange)="checkboxSelected($event)"></p-checkbox>
            <label class="select-label" for="tool">Tool</label>
          </div>
        </div>
      </div>
    </div>
    <div style="display: flex;flex-direction: row; justify-content:space-around;width:100%;">
      <div>
        <button (click)="onPrevious()" pButton pRipple icon="pi pi-chevron-left" style="width: 30px;"
          class="p-button-primary p-button-sm " [disabled]="!showPrevious"></button>
      </div>
      <div style="width:93%;">
        <div class="pmplanner-date-header">
          <p class="card-text">{{titleString}}</p>
        </div>
        <div class="card ">
          <div class="card request-card ">
            <span class="request-content-title hover-pointer zoom-on-hover" (click)="onClickRequest()"
              style="margin-left:12px;"> Total
              Requests: {{ getProperty('request',forecastDisplayData).count }}</span>
            <div *ngIf="getProperty('request',forecastDisplayData).count >0">
              <button pButton type="button" icon="pi pi-table" class="grid_chart_selection_button"
                (click)="[$event.stopPropagation(),onClickGridButton()]"
                [ngClass]="{'p-button-primary': showCardGrid, 'p-button-secondary': !showCardGrid}"></button>
              <button pButton type="button" icon="pi pi-chart-bar" class="grid_chart_selection_button"
                (click)="[$event.stopPropagation(),onClickChartButton()]"
                [ngClass]="{'p-button-primary': showCardChart, 'p-button-secondary': !showCardChart}"></button>
            </div>
          </div>
          <div *ngIf="getProperty('request',forecastDisplayData).count >0" class="example-container">
            <p-accordion (onOpen)="onTabOpen($event)">
              <p-accordionTab *ngFor="let key of keyPmPlannerList;" [selected]="openAccordionTabs.includes(key)">
                <p-header class="atndAcrdn">
                  <div>
                    <span>{{ getDisplayKey(key) }}</span>
                  </div>
                </p-header>
                <div *ngIf="showCardGrid">
                  <table width="100%" style="table-layout: fixed;">
                    <thead>
                      <tr>
                        <th class="table-header">{{ getDisplayKey(key) }}</th>
                        <th class="table-header" style="text-align: right;">{{ key == 'part' ? 'Available Quantity'
                          :'Available Hours' }}
                        </th>
                        <th class="table-header" style="text-align: right;">
                          {{ key == 'part' ? 'Required Quantity' :'Required Hours' }}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let subItem of getProperty(key,forecastDisplayData)" [ngStyle]="{
                        'background-color': key =='part' && subItem.requiredHours > subItem.availableQuantity ? '#ff9999' : key !='part' && subItem.requiredHours > subItem.availableHours ? '#ff9999' : ''
                      }">
                        <td class="card-content-title" class="card-content-title hover-pointer zoom-on-hover"
                          (click)="onClickDetails(key,subItem.id)">{{subItem.name}}</td>
                        <td style="text-align: right;">
                          {{key =='part'?subItem.availableQuantity:subItem.availableHours}}
                        </td>
                        <td style="text-align: right;" class="card-content-title hover-pointer zoom-on-hover"
                          (click)="getPlanDetails()">
                          {{key =='part'?subItem.requiredQuantity:subItem.requiredHours}}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div *ngIf="showCardChart" #chartContainer>
                  <div *ngIf="barchartData.length>0" style="overflow: auto;">
                    <div style="display: flex;">
                      <ngx-charts-bar-vertical-2d [view]="view" [scheme]="colorScheme" [results]="barchartData"
                        [xAxis]="showXAxis" [yAxis]="showYAxis" [legend]="showLegend" [gradient]="gradient"
                        [showXAxisLabel]="showXAxisLabel" [showYAxisLabel]="showYAxisLabel" [xAxisLabel]="xAxisLabel"
                        [yAxisLabel]="yAxisLabel" [showGridLines]="showGridLines"
                        (select)="onSelectBarChart($event,key)">
                      </ngx-charts-bar-vertical-2d>
                      <div class="legend">
                        <div class="legend-title-container">
                          <p class="legend-title">Legend</p>
                        </div>
                        <div class="legend-wrap">
                          <ul class="legend-labels" *ngFor="let item of legendItems">
                            <li class="legend-label">
                              <span title="{{item.name}}">
                                <span class="legend-label-color" [style.background-color]="item.color"></span>
                                <span class="legend-label-text">{{item.name}}</span>
                              </span>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="!(barchartData.length>0)"
                    style="width:100%;height:450px; display:flex;justify-content: center;align-items: center;">
                    <div>
                      <h1>No data found</h1>
                    </div>
                  </div>
                </div>
              </p-accordionTab>
            </p-accordion>
          </div>
        </div>
      </div>
      <div>
        <button (click)="onNext()" pButton pRipple icon="pi pi-chevron-right" style="width: 30px;"
          class="p-button-primary p-button-sm " [disabled]="!showNext"></button>
      </div>
    </div>
  </div>
</div>

<p-dialog header="Requests List" [(visible)]="displayRequestList" [modal]="true" [style]="{width: '70vw'}"
  [maximizable]="false" [draggable]="false" [resizable]="false" [closable]="false">
  <p-table #tt [value]="requestsList" [paginator]="true" [rows]="rowCount" [scrollable]="true" scrollDirection="both"
    scrollHeight="500px" [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [rowsPerPageOptions]="[5,10,25]"
    styleClass="p-datatable-customers p-datatable-gridlines" [rowHover]="false">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="dateRequested">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Requested Date </p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="dateRequested"></p-sortIcon>
              <p-columnFilter type="text" field="dateRequested" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
        <th pSortableColumn="escDateResponded">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Date To Respond</p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="escDateResponded"></p-sortIcon>
              <p-columnFilter type="text" field="escDateResponded" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
        <th pSortableColumn="escDateResponded">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Date To Perform</p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="escDateResponded"></p-sortIcon>
              <p-columnFilter type="text" field="escDateResponded" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
        <th pSortableColumn="escDateCompleted">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Date To Complete</p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="escDateCompleted"></p-sortIcon>
              <p-columnFilter type="text" field="escDateCompleted" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
        <th pSortableColumn="building">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Building</p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="building"></p-sortIcon>
              <p-columnFilter type="text" field="building" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
        <th pSortableColumn="floor">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Floor</p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="floor"></p-sortIcon>
              <p-columnFilter type="text" field="floor" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
        <th pSortableColumn="room">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Room </p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="room"></p-sortIcon>
              <p-columnFilter type="text" field="room" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
        <th pSortableColumn="eqCode">
          <div class="grid-header-column">
            <div class="grid-header-label">
              <p class="grid-label-paragraph">Asset </p>
            </div>
            <div class="grid-sort-icon">
              <p-sortIcon field="eqCode"></p-sortIcon>
              <p-columnFilter type="text" field="eqCode" display="menu"></p-columnFilter>
            </div>
          </div>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-wr>
      <tr [pSelectableRow]="wr">
        <td>{{wr.dateRequested | date :"dd MMM yyyy"}}</td>
        <td>{{wr.escDateResponded | date :"dd MMM yyyy"}}
          {{convertToDisplayTime(wr.escTimeResponded)}}
        </td>
        <td>{{wr.dateToPerform | date :"dd MMM yyyy"}} {{convertToDisplayTime(wr.escTimeResponded)}}
        </td>
        <td>{{wr.escDateCompleted | date :"dd MMM yyyy"}}
          {{convertToDisplayTime(wr.escTimeCompleted)}}
        </td>
        <td>{{wr.building}}</td>
        <td>{{wr.floor}}</td>
        <td>{{wr.room}}</td>
        <td>{{wr.eqCode}}</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="8">
          No records found.
        </td>
      </tr>
    </ng-template>
  </p-table>
  <ng-template pTemplate="footer">
    <button icon="pi pi-times" pButton label="Close" styleClass="p-button-text"
      (click)="displayRequestList = false"></button>
  </ng-template>
</p-dialog>

<p-dialog id="Trade Details" [(visible)]="showTradeDetails" *ngIf="showTradeDetails"
  [style]="{width: tradeDetailsDialogWidth}" [modal]="true" [draggable]="false">
  <app-trade-details [selectedTrade]="selectedTrade"></app-trade-details>
</p-dialog>

<p-dialog header="Part Details" [(visible)]="showPartDetails" *ngIf="showPartDetails"
  [style]="{width: tradeDetailsDialogWidth}" [modal]="true" [draggable]="false">
  <app-part-details [selectedPart]="selectedPart"></app-part-details>
</p-dialog>

<p-dialog header="Tool Details" [(visible)]="showToolDetails" *ngIf="showToolDetails"
  [style]="{width: tradeDetailsDialogWidth}" [modal]="true" [draggable]="false">
  <form [formGroup]="frmToolsDetail" class="disabled-form">
    <mat-card>
      <mat-card-content id="tool">
        <app-add-tools class="disabled-form " formControlName="toolsFormPanel"></app-add-tools>
      </mat-card-content>
    </mat-card>
  </form>
</p-dialog>

<p-dialog [(visible)]="showPlanDetails" [style]="{'width': dialogWidth, 'height': dialogHeight}" *ngIf="showPlanDetails"
  [modal]="true" [draggable]="false" [closable]="false">
  <app-forecast-plan-details [planData]="planData"></app-forecast-plan-details>

  <ng-template pTemplate="footer">
    <button icon="pi pi-times" pButton label="Close" styleClass="p-button-text" (click)="onCloseDetails()"
      class="p-button-secondary p-button-sm "></button>
  </ng-template>
</p-dialog>


<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#879cc9" class="spinner-color" type="ball-spin-clockwise"
  *ngIf="showSpinner" [fullScreen]="true">
  <p style="color: white"> Loading... </p>
</ngx-spinner>